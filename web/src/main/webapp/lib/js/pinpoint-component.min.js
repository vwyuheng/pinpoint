/*! pinpoint - v1.5.2 - 2016-03-15 - TimeSlider + BigScatterChart2 + InfiniteCircularScroll*//*! pinpoint - v1.5.2 - 2016-03-15 */(function(w, $) {
    'use strict';
    var TimeSlider = function( id, options ) {
        this.$snap = $("#" + id);
        this.snap = Snap("#" + id);
        this._init( options );
        this._initControlClass();
        this._addInnerEventListener();
    };
    TimeSlider.prototype._init = function( options ) {
        this.groups = {};
        this._aListener = {
            "inEvent": [],
            "outEvent": [],
            "clickEvent": [],
            "selectTime": [],
            "changeSliderTimeSeries": [],
            "changeSelectionZone": []
        };
        this.opt = {
            "duration": 300,
            "xAxisTicks": 5,
            "eventZoneHeight": 30,        // 하단 이벤트 영역의 height
            "headerZoneHeight": 20,       // 상단 시간 표시영역의 height
            "stateLineThickness": 4,       // 상태선의 두께
            "minSliderTimeSeries": 6000,             // 6sec
            // "maxSliderTimeSeries": 172800000,         // 2day
            "maxSelectionTimeSeries": 172800000,
            "headerTextTopPadding": 10,   // 상단 상태선과 시간 text의 간격
            "selectionPointRadius": 5
        };
        this.opt.minSliderTimeSeries = ( this.opt.xAxisTicks + 1 ) * 1000;
        var p;
        for( p in options ) {
            this.opt[p] = options[p];
        }
        this.oEventData = new TimeSlider.EventData( this.opt.eventData || [] );
        this._checkOffset();
    };
    TimeSlider.prototype._initControlClass = function( options ) {
        var self = this;

        this.oPositionManager = new TimeSlider.PositionManager( {
            "width": this.opt.width,
            "selectTime": this.opt.selectTime,
            "xAxisTicks": this.opt.xAxisTicks,
            "handleTimeSeries": this.opt.handleTimeSeries,
            "sliderTimeSeries": this.opt.timeSeries,
            "minSliderTimeSeries": this.opt.minSliderTimeSeries,
            "maxSelectionTimeSeries": this.opt.maxSelectionTimeSeries
        });
        var contentZoneHeight = this.opt.height - this.opt.headerZoneHeight - this.opt.eventZoneHeight;

        // this.oTimeSeriesSignboard = new TimeSlider.TimeSeriesSignboard( this, this.getGroup("time-series-signboard", TimeSlider.GROUP_TYPE.CONTENT_BASE, TimeSlider.oDrawOrder["time-series-signboard"]), {
        //     "height": contentZoneHeight,
        //     "duration": this.opt.duration
        // });
        this.oLoading = new TimeSlider.LoadingIndicator( this, this.getGroup("loading", TimeSlider.GROUP_TYPE.TOP_BASE, TimeSlider.oDrawOrder["loading"]), {
            "width": this.opt.width,
            "height": this.opt.height,
            "duration": 2000
        });
        this.oBackground = new TimeSlider.Background( this, this.getGroup("background", TimeSlider.GROUP_TYPE.CONTENT_BASE, TimeSlider.oDrawOrder["background"]), {
            "top": 0,
            "left": 0,
            "width": this.opt.width,
            "height": contentZoneHeight,
            "duration": this.opt.duration
        });
        this.oSelectionManager = new TimeSlider.SelectionManager( this, {
            "margin": this.opt.left,
            "height": this.opt.height,
            "duration": this.opt.duration,
            "handleSrc": this.opt.handleSrc,
            "eventZoneHeight": this.opt.eventZoneHeight,
            "headerZoneHeight": this.opt.headerZoneHeight,
            "contentZoneHeight": contentZoneHeight,
            "selectionPointRadius": this.opt.selectionPointRadius
        });
        this.oXAxis = new TimeSlider.XAxis( this, this.getGroup("x-axis", TimeSlider.GROUP_TYPE.TOP_BASE, TimeSlider.oDrawOrder["x-axis"]), {
            "endY": this.opt.height - this.opt.eventZoneHeight,
            "width": this.opt.width,
            "textY": this.opt.headerTextTopPadding,
            "startY": this.opt.headerZoneHeight,
            "duration": this.opt.duration
        });
        this.oStateLine = new TimeSlider.StateLine( this, this.getGroup("state-line", TimeSlider.GROUP_TYPE.TOP_BASE, TimeSlider.oDrawOrder["state-line"]), {
            "width": this.opt.width,
            "duration": this.opt.duration,
            "topLineY": this.opt.headerZoneHeight,
            "thickness": this.opt.stateLineThickness,
            "timeSeries": this.opt.timeSeries,
            "bottomLineY": this.opt.height - this.opt.eventZoneHeight
        } );
        this.oEvents = new TimeSlider.Events( this, this.getGroup("events", TimeSlider.GROUP_TYPE.BOTTOM_BASE, TimeSlider.oDrawOrder["events"]), {
            "duration": this.opt.duration
        } );

        this.oLoading.hide();
    };
    TimeSlider.prototype.getGroup = function(name, type, zIndex) {
        if( this.groups[name] ) {
            return this.groups[name];
        }
        var g = this.groups[name] = this.snap.g().attr({
            "class": name,
            "data-order": zIndex
        });
        this._setTransform( g, type );
        this._sortGroup( g, zIndex );
        return this.groups[name];
    };
    TimeSlider.prototype._setTransform = function( newGroup, type ) {
        switch( type ) {
            case TimeSlider.GROUP_TYPE.TOP_BASE:
                break;
            case TimeSlider.GROUP_TYPE.CONTENT_BASE:
                newGroup.attr({ transform: "translate(0, " + this.opt.headerZoneHeight + ")" });
                break;
            case TimeSlider.GROUP_TYPE.BOTTOM_BASE:
                newGroup.attr({ transform: "translate(0, " + (this.opt.height - this.opt.eventZoneHeight) + ")" });
                break;
        }
    };
    TimeSlider.prototype._sortGroup = function( newGroup, zIndex ) {
        var aGroups = this.snap.selectAll("g");
        var afterGroup = null;
        for( var i = aGroups.length - 1; i >= 0 ; i-- ) {
            if( aGroups[i] == newGroup ) continue;
            if ( zIndex < parseInt( aGroups[i].attr("data-order") ) ) {
                afterGroup = aGroups[i];
            }
        }
        if ( afterGroup !== null ) {
            afterGroup.before( newGroup );
        }
    };
    TimeSlider.prototype._checkOffset = function() {
        var o = this.$snap.offset();
        this.opt.top = o.top;
        this.opt.left = o.left;
    };
    TimeSlider.prototype._addInnerEventListener = function() {
        var self = this;
        var mousedownX = -1;
        $(window).on("resize", function() {
            self._checkOffset();
            self._resize();
        });
        this.snap.mousemove(function(event, x, y) {
        });
        this.snap.mouseout(function(event, x, y) {
        });
        this.snap.mousedown(function(event, x, y) {
            mousedownX = x;
        });
        this.snap.click(function(event, x, y) {
            if ( mousedownX !== x ) return;
            self.oSelectionManager.onMouseClick(event, x - self.opt.left, y - self.opt.top);
        });
    };
    TimeSlider.prototype.fireEvent = function( eventType, argu ) {
        this._aListener[eventType].forEach(function(fn) {
            fn( argu );
        });
    };
    TimeSlider.prototype.addEvent = function( eventType, listener ) {
        this._aListener[eventType].push( listener );
        return this;
    };
    TimeSlider.prototype.addEventData = function( aNewData ) {
        this.oLoading.show();
        var aBoundary = this.oEventData.addData( aNewData );
        this.oEvents.changeData();
        this.oStateLine.changeData();
        this.oLoading.hide();
    };
    TimeSlider.prototype.reset = function() {
        // this.oTimeSeriesSignboard.reset();
        this.oXAxis.reset();
        this.oSelectionManager.reset();
        this.oStateLine.reset();
        this.oEvents.reset();
    };
    TimeSlider.prototype._resize = function() {
        //this.oPositionManager.setWidth( this.$snap.width() );
		this.oPositionManager.setWidth( this.$snap.get(0).getBoundingClientRect().width );
        this.oBackground.reset();
        // this.oTimeSeriesSignboard.resize();
        this.reset();
    };
    TimeSlider.prototype.zoomIn = function( zoomLevel ) {
        // 1/2배씩
        this.oPositionManager.zoomIn();
        this.reset();
    };
    TimeSlider.prototype.zoomOut = function( zoomLevel ) {
        // 2배씩
        this.oPositionManager.zoomOut();
        this.reset();
    };
    TimeSlider.prototype.getSliderTimeSeries = function() {
        return this.oPositionManager.getSliderTimeSeries();
    };
    TimeSlider.prototype.getSelectionTimeSeries = function() {
        return this.oPositionManager.getSelectionTimeSeries();
    };
    TimeSlider.prototype.setDefaultStateLineColor = function( color ) {
        this.oStateLine.setDefaultStateLineColor( color );
    };
    TimeSlider.prototype.emptyData = function() {
        this.oLoading.show();
        var aBoundary = this.oEventData.emptyData();
        this.oEvents.emptyData();
        this.oStateLine.emptyData();
        this.oLoading.hide();
    };
    TimeSlider.prototype.setSelectTime = function( time ) {
        this.oSelectionManager.setSelectTime( time );
    };

    TimeSlider.GROUP_TYPE = {
        TOP_BASE: "top-base",
        CONTENT_BASE: "content-base",
        BOTTOM_BASE: "bottom-base"
    };
    TimeSlider.oDrawOrder = {
        "background": 0,
        "selection-zone": 5,
        "time-series-signboard": 7,
        "x-axis": 10,
        "events": 10,
        "time-signboard": 15,
        "selection-point": 15,
        "state-line": 20,
        "left-handler": 25,
        "right-handler": 25,
        "guide": 30,
        "loading": 100
    };
    TimeSlider.EventColor = {
        "base": "rgba(187, 187, 187, .3)",
        "10100": "#009E00",         //Agent connected
        "10199": "#FAEBD7",            //Agent ping
        "10200": "#D15260",            //Agent shutdown
        "10201": "#E95C63",            //Agent unexpected shutdown
        "10300": "#FF9D7B",            //Agent connection closed by server
        "10301": "#F2F089",            //Agent connection unexpectedly closed by server
        "20100": "#00F"             //thread dump
    };
    w.TimeSlider = TimeSlider;
})(window, jQuery);

(function(w, $) {
    var ts = w.TimeSlider;
    ts.Background = function( timeSlider, svgGroup, options ) {
        this.timeSlider = timeSlider;
        this.opt = options;
        this.group = svgGroup;
        this._addElements();
    };
    ts.Background.prototype._addElements = function() {
        this.rect = this.timeSlider.snap.rect(this.opt.left, this.opt.top, this.opt.width, this.opt.height);
        this.group.add(this.rect);
    };
    ts.Background.prototype.reset = function() {
        this.rect.animate({
            "width": this.timeSlider.oPositionManager.getSliderEndPosition()
        }, this.opt.duration, mina.easein);
    };
})(window, jQuery);

(function(w, $) {
    var ts = w.TimeSlider;
    ts.Configuration = function( options ) {
        this._init( options );
    };
    ts.Configuration.prototype._init = function( options ) {
        console.log( options );
        var defaultOptions = {
            "duration": 300,
            "xAxisTicks": 5,
            "eventZoneHeight": 30,        // 하단 이벤트 영역의 height
            "headerZoneHeight": 20,       // 상단 시간 표시영역의 height
            "stateLineThickness": 4,       // 상태선의 두께
            "minSliderTimeSeries": 6000,             // 6sec
            "maxSliderTimeSeries": 172800000,         // 2day
            "headerTextTopPadding": 10,   // 상단 상태선과 시간 text의 간격
            "selectionPointRadius": 5
        };
        var backgroundOptions = {
            "backgroundTop": 0,
            "backgroundLeft": 0
        };
        var loadingIndicatorOptions = {
            "loadingDuration": 2000
        };
        this._setOptions( defaultOptions );
        this._setOptions( backgroundOptions );
        this._setOptions( loadingIndicatorOptions );
        this._setOptions( options );

        this._checkMinSliderTimeSeries();
        this._contentZoneHeight = this["height"] - this["headerZoneHeight"] - this["eventZoneHeight"];
    };
    ts.Configuration.prototype._checkMinSliderTimeSeries = function( opt ) {
        var minSliderTimeSeries = ( this.xAxisTicks + 1 ) * 1000 ;
        this.minSliderTimeSeries = this.minSliderTimeSeries < minSliderTimeSeries ? minSliderTimeSeries : this.minSliderTimeSeries;
    };
    ts.Configuration.prototype.setOffset = function( offset ) {
        this["offsetLeft"] = offset.left;
        this["offsetTop"] = offset.top;
    };
    ts.Configuration.prototype._setOptions = function( options ) {
        for( var p in options ) {
            this[p] = options[p];
        };
    };
    ts.Configuration.prototype.getContentZoneHeight = function() {
        return this._contentZoneHeight;
    };
})(window, jQuery);

(function(w, $) {
    var ts = w.TimeSlider;
    ts.EventData = function( aRawData ) {
        this._init( aRawData );
    };
    ts.EventData.prototype._init = function( aRawData ) {
        var self = this;
        this._aRawData = aRawData;
        this._oHash = {};
        this._aRawData.forEach(function( o ) {
            self._oHash[self.makeID(o)] = o;
        });
    };
    ts.EventData.prototype.makeID = function( oEvent ) {
        return oEvent.eventTypeCode + "-" + oEvent.eventTimestamp;
    };
    ts.EventData.prototype.count = function() {
        return this._aRawData.length;
    };
    ts.EventData.prototype.getDataByIndex = function( index ) {
        return this._aRawData[index];
    };
    ts.EventData.prototype.getDataByKey = function( key ) {
        return this._oHash[key];
    };
    ts.EventData.prototype.emptyData = function() {
        this._aRawData = [];
        this._oHash = {};
    };
    ts.EventData.prototype.addData = function( aNewData ) {
        if ( aNewData.length === 0 ) return;

        var i, j;
        var beforeBoundary = this._getBeforeDataBoundary( aNewData );
        for ( i = beforeBoundary ; i >= 0 ; i-- ) {
            this._aRawData.unshift( aNewData[i] );
            this._oHash[this.makeID(aNewData[i])] = aNewData[i];
        }

        var afterBoundary = this._getAfterDataBoundary( aNewData, beforeBoundary );
        for ( i = afterBoundary ; i < aNewData.length ; i++ ) {
            this._aRawData.push( aNewData[i] );
            this._oHash[this.makeID(aNewData[i])] = aNewData[i];
        }

        beforeBoundary = beforeBoundary === -1 ? 0 : beforeBoundary + 1;
        afterBoundary = afterBoundary === Number.MAX_SAFE_INTEGER ? aNewData.length - 1 : afterBoundary - 1;

        var skip = beforeBoundary;
        if ( afterBoundary > beforeBoundary ) {
            for( i = beforeBoundary ; i < this._aRawData.length ; i++ ) {
                var rawTimestamp = this._aRawData[i].eventTimestamp;
                for( j = skip; j < aNewData.length ; j++ ) {
                    var oNewEventData = aNewData[j];
                    if ( oNewEventData.eventTimestamp < rawTimestamp ) {
                        this._aRawData.splice( i, 0, oNewEventData );
                        this._oHash[this.makeID(oNewEventData)] = oNewEventData;
                        i++;
                        skip = j + 1;
                    } else if ( oNewEventData.eventTimestamp === rawTimestamp ) {
                        skip = j + 1;
                        break;
                    }
                }
                if ( skip === aNewData.length ) break;
            }
        }
    };
    ts.EventData.prototype._getBeforeDataBoundary = function( aNewData ) {
        var boundary = -1;
        if ( this._aRawData.length === 0 ) {
            boundary = aNewData.length - 1;
        } else {
            var startTime = this._aRawData[0].eventTimestamp;
            var len = aNewData.length;
            for ( var i = 0 ; i < len ; i++ ) {
                var time = aNewData[i].eventTimestamp;
                if ( time < startTime ) {
                    boundary = i;
                } else {
                    break;
                }
            }
        }
        return boundary;
    };
    ts.EventData.prototype._getAfterDataBoundary = function( aNewData, skipIndex ) {
        var boundary = Number.MAX_SAFE_INTEGER;
        var startIndex = skipIndex + 1;
        var len = aNewData.length;
        if ( len > startIndex ) {
            var endTime = this._aRawData[this._aRawData.length - 1].eventTimestamp;
            for ( var i = startIndex ; i < len ; i++ ) {
                var time = aNewData[i].eventTimestamp;
                if ( time > endTime ) {
                    boundary = i;
                    break;
                }
            }
        }
        return boundary;
    };

})(window, jQuery);

(function(w, $) {
    var consts = {
        ID_POSTFIX: "+event-circle",
        ID_SPLITER: "+"
    };
    var ts = w.TimeSlider;
    ts.Events = function( timeSlider, svgGroup, options ) {
        this.timeSlider = timeSlider;
        this.group = svgGroup;
        this._oEventData = timeSlider.oEventData;

        this._init(options);
        this._addEventElements();
        this._addEvents();
    };
    ts.Events.prototype._init = function( options ) {
        this._oEventGroupElementHash = {};
        this.opt = {
            "y": 4,
            "barLength": 4,
            "gapBarNCircle": 2,
            "circleRadius": 8
        };
        for( var p in options ) {
            this.opt[p] = options[p];
        }
        this._filterShadow = this.timeSlider.snap.filter( Snap.filter.shadow(1, 1, 1, "#000", 0.3));
    };
    ts.Events.prototype._addEventElements = function() {
        var len = this._oEventData.count();
        for ( var i = 0 ; i < len ; i++ ) {
            this._addEventElement( this._oEventData.getDataByIndex(i), true );
        }
    };
    ts.Events.prototype._addEventElement = function( oEvent, bAppend ) {
        var el = this._makeElement( oEvent );
        this.group[bAppend ? "append": "prepend"]( el );
        if ( this.timeSlider.oPositionManager.isInSliderTimeSeries( oEvent.eventTimestamp ) === false ) {
            this.hide( el );
        }
        return el;
    };
    ts.Events.prototype._makeID = function( oEvent ) {
        return this._oEventData.makeID( oEvent ) + consts.ID_POSTFIX;
    };
    ts.Events.prototype._makeElement = function( oEvent ) {
        var opt = this.opt;
        var time = oEvent.eventTimestamp;
        var groupID = this._makeID( oEvent );
        var elEventGroup = this.group.g().attr({
            "data-id": groupID,
            "data-time": time,
            "transform": "translate(" + this.timeSlider.oPositionManager.getPositionFromTime( time ) + ",0)"
        }).add(
            this.timeSlider.snap.line( 0, opt.y, 0, opt.y + opt.barLength ),
            this.timeSlider.snap.circle( 0, opt.y + opt.circleRadius + opt.gapBarNCircle + opt.barLength, opt.circleRadius ).attr({
                "fill": TimeSlider.EventColor[oEvent.eventTypeCode],
                "class": "event",
                "filter": this._filterShadow,
                "data-time": time
            })
        );
        this._oEventGroupElementHash[groupID] = elEventGroup;
        return elEventGroup;
    };
    ts.Events.prototype._addEvents = function() {
        var self = this;
        this.group.mouseover(function(event, x, y) {
            self._fireEvent( "inEvent", event, x, y );
        });
        this.group.mouseout(function(event, x, y) {
            self._fireEvent( "outEvent", event, x, y );
        });
        this.group.click(function(event, x, y) {
            self._fireEvent( "clickEvent", event, x, y );
        });
    };
    ts.Events.prototype._fireEvent = function( eventType, event, x, y ) {
        this.timeSlider.fireEvent(eventType, [x, y, this._oEventData.getDataByKey( event.srcElement.parentNode.getAttribute("data-id").split(consts.ID_SPLITER)[0] )] );
    };
    ts.Events.prototype.reset = function() {
        var self = this;
        for ( var p in this._oEventGroupElementHash ) {
            var elGroupEvent = this._oEventGroupElementHash[p];
            var time = this._oEventData.getDataByKey(p.split(consts.ID_SPLITER)[0]).eventTimestamp;

            if ( self.timeSlider.oPositionManager.isInSliderTimeSeries( time ) ) {
                self.show( elGroupEvent );
                (function( el, x ) {
                    el.animate({
                        "transform": "translate(" + x + ",0)"
                    }, self.opt.duration);
                })(elGroupEvent, this.timeSlider.oPositionManager.getPositionFromTime( time ));
            } else {
                (function( el, x ) {
                    el.animate({
                        "transform": "translate(" + x + ",0)"
                    }, self.opt.duration, function() {
                        self.hide( el );
                    });
                })(elGroupEvent, self.timeSlider.oPositionManager.isBeforeSliderStartTime( time ) ? 0 : self.timeSlider.oPositionManager.getSliderEndPosition() );
            }
        }
    };
    ts.Events.prototype.changeData = function() {
        var aGroupElements = this.group.selectAll("g");
        if ( aGroupElements.length === 0 ) {
            this._addEventElements();
            return;
        }
        var i, j, oEvent, skip = 0, lenData = this._oEventData.count(), lenElements = aGroupElements.length;
        var lastElement = aGroupElements[lenElements - 1];

        for( i = 0 ; i < lenElements ; i++ ) {
            var el = aGroupElements[i];
            var timestamp = parseInt( el.attr("data-time") );

            for( j = skip ; j < lenData ; j++ ) {
                oEvent = this._oEventData.getDataByIndex(j);
                if ( oEvent.eventTimestamp < timestamp ) {
                    el.before( this._makeElement( oEvent ) );
                    skip = j;
                } else if ( oEvent.eventTimestamp === timestamp ) {
                    skip = j + 1;
                    lastElement = el;
                    break;
                } else {
                    skip = j;
                    lastElement = el;
                    break;
                }
            }
        }
        for( skip ; skip < lenData ; skip++ ) {
            oEvent = this._oEventData.getDataByIndex(skip);
            var newEl = this._makeElement( oEvent );
            lastElement.after( newEl );
            lastElement = newEl;
        }
        this.reset();
    };
    ts.Events.prototype.emptyData = function() {
        for ( var p in this._oEventGroupElementHash ) {
            this._oEventGroupElementHash[p].remove();
        }
        this._oEventGroupElementHash = {};
    };
    ts.Events.prototype.show = function( el ) {
        el.attr("display", "block");
    };
    ts.Events.prototype.hide = function( el ) {
        el.attr("display", "none");
    };

})(window, jQuery);

(function(w, $) {
    var consts = {
        HANDLER_IMAGE_WIDTH: 30,
        HANDLER_IMAGE_HEIGHT: 18
    };
    var ts = w.TimeSlider;
    ts.Handler = function( timeSlider, svgGroup, options, callbackStart, callbackDrag, callbackEnd ) {
        this.timeSlider = timeSlider;
        this.group = svgGroup;
        this.opt = options;
        this._previousX = options.x;
        this._handleSrc = options.handleSrc || consts.NORMAL_IMG;
        this._handleDownSrc = this._getHandleDownSrc();
        this.callbackStart = callbackStart;
        this.callbackDrag = callbackDrag;
        this.callbackEnd = callbackEnd;
        this._addElements();
        this.setX( options.x );
        this.addEvent();
    };
    ts.Handler.prototype._getHandleDownSrc = function() {
        var lastIndex = this._handleSrc.lastIndexOf( "." );
        return this._handleSrc.substring( 0 , lastIndex ) + "_down" + this._handleSrc.substring( lastIndex );
    };
    ts.Handler.prototype._addElements = function() {
        this.handlerGrip = this.timeSlider.snap.image( this._handleSrc, -(consts.HANDLER_IMAGE_WIDTH / 2), -(consts.HANDLER_IMAGE_HEIGHT / 2), consts.HANDLER_IMAGE_WIDTH, consts.HANDLER_IMAGE_HEIGHT );
        this.handlerGroup = this.group.g();
        this.handlerGroup.add(
            this.timeSlider.snap.line( 0, 0, 0, this.opt.height ),
            this.handlerGrip
        );
    };
    ts.Handler.prototype.addEvent = function( callback ) {
        var self = this;
        var lastX = -1;
        // onmove, onstart, onend
        this.handlerGrip.mousedown(function(event, x, y) {
            event.stopPropagation();
        });
        this.handlerGrip.click(function(event, x, y) {
            event.stopPropagation();
        });
        this.handlerGrip.drag(function(dx, dy, x, y, event) {
            var newX = x - self.opt.margin;
            if ( self._isInRestirctionZone( newX ) === false ) return;
            self.handlerGroup.attr({ transform: "translate(" + newX + ", 0)" });
            lastX = newX;
            self.callbackDrag( newX );
        }, function(x, y, event) {
            event.stopPropagation();
            self.handlerGrip.attr( "href", self._handleDownSrc );
            self.callbackStart( x - self.opt.margin );
        }, function(event) {
            event.stopPropagation();
            self.handlerGrip.attr( "href", self._handleSrc );
            if ( self._previousX !== lastX && lastX !== -1 ) {
                self.callbackEnd( true, lastX );
                self._previousX = lastX;
            } else {
                self.callbackEnd( false );
            }
        });
    };
    ts.Handler.prototype.setX = function( x ) {
        this.handlerGroup.animate({
            "transform": "translate(" + x + ", 0)"
        }, this.opt.duration, mina.easeout);
    };
    ts.Handler.prototype._isInRestirctionZone = function( x ) {
        return ( x <= this.opt.zone[0] || x >= this.opt.zone[1] ) ? false : true;
    };
    ts.Handler.prototype.setZone = function( start, end ) {
        this.opt.zone = [start, end];
    };
    ts.Handler.prototype.setPositionAndZone = function( x, aZone ) {
        this.setX( x );
        this.callbackDrag( x );
        this.setZone( aZone[0], aZone[1] );
    };

})(window, jQuery);

(function(w, $) {
    var consts = {
        SIZE: 30
    };
    var ts = w.TimeSlider;
    ts.LoadingIndicator = function( timeSlider, svgGroup, options ) {
        this.timeSlider = timeSlider;
        this.opt = options;
        this.group = svgGroup;
        this._bRunn = false;
        this._addElements();
        this.show();
    };
    ts.LoadingIndicator.prototype._addElements = function() {
        var size = 30;
        var halfSize = consts.SIZE / 2;
        var x = this.opt.width / 2 - halfSize;
        var y = this.opt.height / 2 - halfSize;
        this.group.add( this.timeSlider.snap.rect(0, 0, this.opt.width, this.opt.height) );
        this.elClockwiseBox = this.timeSlider.snap.rect(x, y, consts.SIZE, consts.SIZE).attr({
            "stroke": "rgba(197, 197, 197, .9)"
        });
        this.elAnitclockwiseBox = this.timeSlider.snap.rect(x, y, consts.SIZE, consts.SIZE).attr({
            "stroke": "rgba(239, 246, 105, .9)"
        });
        this.group.add( this.elClockwiseBox, this.elAnitclockwiseBox );
    };
    ts.LoadingIndicator.prototype.show = function() {
        this.group.attr("display", "block");
        this._bRunn = true;
        this._animate( this.elClockwiseBox, 0, 360, mina.easeout );
        this._animate( this.elAnitclockwiseBox, 45, -315, mina.easein );
    };
    ts.LoadingIndicator.prototype._animate = function( ele, from, to, fnEase ) {
        var self = this;
        Snap.animate( from, to, function(val) {
            ele.attr("transform", "rotate(" + val + "deg)");
        }, self.opt.duration, fnEase, function() {
            if ( self._bRunn === true ) {
                self._animate( ele, to, from, fnEase );
            }
        });
    };
    ts.LoadingIndicator.prototype.hide = function() {
        this.group.attr("display", "none");
        this._bRunn = false;
    };
})(window, jQuery);

(function(w, $) {
    var consts = {
        xAxisTicks: 5
    };
    var ts = w.TimeSlider;
    ts.PositionManager = function( options ) {
        this._width = options.width;
        this._minSliderTimeSeries = options.minSliderTimeSeries;
        this._maxSelectionTimeSeries = options.maxSelectionTimeSeries;

        this._initInnerVar();
        this._setSliderTimeSeries( options.sliderTimeSeries[0], options.sliderTimeSeries[1] );
        this._initSelectionTimeSeries( options.handleTimeSeries || [] );
        this._resetSelectionByTime();
        this._xAxisTicks = options.xAxisTicks || consts.xAxisTicks;
        this.setSelectTime( options.selectTime );
    };
    ts.PositionManager.prototype._initInnerVar = function() {
        this._aSelectionTimeSeries = [];
        this._aSelectionPosition = [];
    };
    ts.PositionManager.prototype._setSliderTimeSeries = function( start, end ) {
        this._startTime = start;
        this._endTime = end;
        this._calcuTimePerPoint();
    };
    ts.PositionManager.prototype._initSelectionTimeSeries = function( aTime ) {
        if ( aTime.length != 2 ) {
            aTime = [ this._startTime, this._endTime ]; // TODO ??
        }
        if ( aTime[1] - aTime[0] > this._maxSelectionTimeSeries ) {
            aTime[0] = aTime[1] - this._maxSelectionTimeSeries;
        }
        this._setSelectionTimeSeries( aTime[0], aTime[1] );
    };
    ts.PositionManager.prototype._resetSelectionByPosition = function() {
        this._setSelectionTimeSeries( this.getTimeFromPosition( this._aSelectionPosition[0] ), this.getTimeFromPosition( this._aSelectionPosition[1] ) );
    };
    ts.PositionManager.prototype._setSelectionTimeSeries = function( start, end ) {
        this._aSelectionTimeSeries[0] = start === null ? this._aSelectionTimeSeries[0] : start;
        this._aSelectionTimeSeries[1] = end === null ? this._aSelectionTimeSeries[1] : end;
    };
    ts.PositionManager.prototype._resetSelectionByTime = function() {
        this._setSelectionPosition( this.getPositionFromTime( this._aSelectionTimeSeries[0] ), this.getPositionFromTime( this._aSelectionTimeSeries[1] ) );
    };
    ts.PositionManager.prototype._setSelectionPosition = function( start, end ) {
        this._aSelectionPosition[0] = start === null ? this._aSelectionPosition[0] : start;
        this._aSelectionPosition[1] = end === null ? this._aSelectionPosition[1] : end;
    };


    ts.PositionManager.prototype.isInMaxSelectionTimeSeries = function( start, end ) {
        return ( end - start ) <= this._maxSelectionTimeSeries;
    };
    ts.PositionManager.prototype.getNewSelectionTimeSeriesFromStart = function( start ) {
        return [ start, start + this._maxSelectionTimeSeries ];
    };
    ts.PositionManager.prototype.getNewSelectionTimeSeriesFromEnd = function( end ) {
        return [ end - this._maxSelectionTimeSeries, end ];
    };
    ts.PositionManager.prototype.isBeforeSliderStartTime = function( time ) {
        return time < this._startTime;
    };
    ts.PositionManager.prototype.isAfterSliderEndTime = function( time ) {
        return time > this._endTime;
    };
    ts.PositionManager.prototype.getSliderEndTime = function() {
        return this._endTime;
    };
    ts.PositionManager.prototype.setWidth = function( width ) {
        this._width = width;
        this._calcuTimePerPoint();
        this._reset();
    };
    ts.PositionManager.prototype.getSliderEndPosition = function() {
        return this._width;
    };
    ts.PositionManager.prototype.getSliderStartTimeStr = function() {
        return this._formatDate( new Date(this._startTime) );
    };
    ts.PositionManager.prototype.getSliderEndTimeStr = function() {
        return this._formatDate( new Date(this._endTime) );
    };
    ts.PositionManager.prototype.getFullTimeStr = function( x ) {
        return this._formatDate( new Date(this.getTimeFromPosition(x)) );
    };
    ts.PositionManager.prototype._formatDate = function( d ) {
        return d.getFullYear() +"." + this._twoChipers( d.getMonth() + 1 ) + "." + this._twoChipers( d.getDate() ) + " " + this._twoChipers( d.getHours() ) + ":" + this._twoChipers( d.getMinutes() ) + ":" + this._twoChipers( d.getSeconds() );
    };
    ts.PositionManager.prototype._twoChipers = function( n ) {
        return n < 10 ? "0" + n : n;
    };
    ts.PositionManager.prototype.isInSelectionZone = function( x ) {
        return ( x >= this._aSelectionPosition[0] && x <= this._aSelectionPosition[1] ) ? true : false;
    };
    ts.PositionManager.prototype.isInSliderTimeSeries = function( time ) {
        return ( time >= this._startTime && time <= this._endTime ) ? true : false;
    };
    ts.PositionManager.prototype.getSliderTimeSeries = function() {
        return [ this._startTime, this._endTime ];
    };
    ts.PositionManager.prototype.getSelectionTimeSeries = function() {
        return [ this._aSelectionTimeSeries[0], this._aSelectionTimeSeries[1] ];
    };
    ts.PositionManager.prototype.getSelectionPosition = function() {
        return [ this._aSelectionPosition[0], this._aSelectionPosition[1] ];
    };
    ts.PositionManager.prototype.isInSelectionZoneSelectPoint = function() {
        if ( this._selectPosition >= this._aSelectionPosition[0] && this._selectPosition <= this._aSelectionPosition[1] ) {
            return true;
        } else {
            return false;
        }
    };
    ts.PositionManager.prototype.getSelectPosition = function() {
        return this._selectPosition;
    };
    ts.PositionManager.prototype.setSelectTime = function( time ) {
        this._selectTime = time;
        this._selectPosition = this.getPositionFromTime( time );
    };
    ts.PositionManager.prototype.setSelectPosition = function( x ) {
        this._selectPosition = x;
        this._selectTime = this.getTimeFromPosition( x );
    };
    ts.PositionManager.prototype.getTimeFromPosition = function( x ) {
        return this._startTime + ( this._timePerPoint * x );
    };
    ts.PositionManager.prototype.getPositionFromTime = function( time ) {
        return parseInt( ( time - this._startTime ) / this._timePerPoint );
    };
    ts.PositionManager.prototype.calcuSelectionZone = function() {
        var defaultZone = parseInt((this._aSelectionPosition[1] - this._aSelectionPosition[0]) / 2);
        var zoneStart = this._selectPosition - defaultZone;
        var zoneEnd = this._selectPosition + defaultZone;
        if ( zoneStart < 0 ) {
            zoneEnd += Math.abs( zoneStart );
            zoneStart = 0;
        } else if ( zoneEnd > this._width ) {
            zoneStart -= ( zoneEnd - this._width );
            zoneEnd = this._width;
        }
        this._setSelectionTimeSeries( this.getTimeFromPosition( zoneStart ), this.getTimeFromPosition( zoneEnd ) );
        this._setSelectionPosition( zoneStart, zoneEnd );
    };
    ts.PositionManager.prototype.getXBarPosition = function() {
        var self = this;
        var max = this._xAxisTicks + 1;
        var space = parseInt( this._width / max );
        var a = [];
        for( var i = 0 ; i < max ; i++ ) {
            if ( i === 0 ) continue;
            var x = i * space;
            a.push( {
                x: x,
                time: self.getTimeStr( x )
            });
        }
        return a;
    };
    ts.PositionManager.prototype.getTimeStr = function( x ) {
        var timeX = ( x * this._timePerPoint ) + this._startTime;
        var d = new Date( timeX );
        return this._twoChipers(d.getMonth() + 1) + "." + this._twoChipers(d.getDate()) + " " + this._twoChipers( d.getHours() ) + ":" + this._twoChipers( d.getMinutes() );
    };
    ts.PositionManager.prototype.setSelectionStartPosition = function( x ) {
        this._setSelectionTimeSeries( this.getTimeFromPosition(x), null );
        this._setSelectionPosition( x, null );
    };
    ts.PositionManager.prototype.setSelectionEndPosition = function( x ) {
        this._setSelectionTimeSeries( null, this.getTimeFromPosition(x) );
        this._setSelectionPosition( null, x );
    };
    ts.PositionManager.prototype.zoomIn = function() {
        // 선택 영역 중심으로 확대
        if( this._startTime === this._aSelectionTimeSeries[0] && this._endTime === this._aSelectionTimeSeries[1] ) return;
        var quarterSliderTime = parseInt( (this._endTime - this._startTime) / 4 );
        var tempStartTime = this._selectTime - quarterSliderTime;
        var tempEndTime = this._selectTime + quarterSliderTime;

        if ( tempEndTime - tempStartTime < this._minSliderTimeSeries ) {
            var minHalf = parseInt( this.minSliderTimeSeris / 2 );
            tempStartTime = this._selectTime - minHalf;
            tempEndTime = this._selectTime + minHalf;
        }
        var gap;
        if ( this._aSelectionTimeSeries[0] < tempStartTime ) {
            gap = tempStartTime - this._aSelectionTimeSeries[0];
            var tempSelectionEndTime = (this._aSelectionTimeSeries[1] + gap > tempEndTime) ? tempEndTime : this._aSelectionTimeSeries[1] + gap;
            this._setSelectionTimeSeries( tempStartTime, tempSelectionEndTime );
        }
        if ( this._aSelectionTimeSeries[1] > tempEndTime ) {
            gap = this._aSelectionTimeSeries[1] - tempEndTime;
            var tempSelectionStartTime = ( this._aSelectionTimeSeries[0] - gap < tempStartTime ) ? tempStartTime : this._aSelectionTimeSeries[0] - gap;
            this._setSelectionTimeSeries( tempSelectionStartTime, tempEndTime );
        }
        this._setSliderTimeSeries( tempStartTime, tempEndTime );
        this._reset();
    };
    ts.PositionManager.prototype.zoomOut = function() {
        var one = this._endTime - this._startTime;
        var tempCenterTime = this._aSelectionTimeSeries[0] + parseInt( ( this._aSelectionTimeSeries[1] - this._aSelectionTimeSeries[0] ) / 2 );
        this._setSliderTimeSeries( tempCenterTime - one, tempCenterTime + one );
        this._reset();
    };
    ts.PositionManager.prototype.resetBySelectTime = function( time ) {
        time = parseInt( time );
        var halfSliderTimeSeries = parseInt( ( this._endTime - this._startTime ) / 2 );
        var halfSelectionTimeSeries = parseInt( ( this._aSelectionTimeSeries[1] - this._aSelectionTimeSeries[0] ) / 2 );
        this._setSliderTimeSeries( time - halfSliderTimeSeries, time + halfSliderTimeSeries );
        this._setSelectionTimeSeries( time - halfSelectionTimeSeries, time + halfSelectionTimeSeries );
        this._resetSelectionByTime();
        this.setSelectTime( time );
    };
    ts.PositionManager.prototype._reset = function() {
        this.setSelectTime( this._selectTime );
        this._resetSelectionByTime();
    };
    ts.PositionManager.prototype._calcuTimePerPoint = function() {
        this._timePerPoint = parseInt( ( this._endTime - this._startTime ) / this._width );
    };
})(window, jQuery);

(function(w, $) {
    var ts = w.TimeSlider;
    ts.SelectionManager = function( timeSlider, options ) {
        this.timeSlider = timeSlider;
        this.opt = options;
        this.initClass();
    };
    ts.SelectionManager.prototype.initClass = function() {
        var self = this;
        var aHandlerPosition = this.timeSlider.oPositionManager.getSelectionPosition();
        this.oSelectionZone = new TimeSlider.SelectionZone( this.timeSlider, this.timeSlider.getGroup("selection-zone", TimeSlider.GROUP_TYPE.CONTENT_BASE, TimeSlider.oDrawOrder["selection-zone"]), {
            "top": 0,
            "left": aHandlerPosition[0],
            "width": aHandlerPosition[1] - aHandlerPosition[0],
            "height": this.opt.contentZoneHeight,
            "duration": 50//this.opt.duration
        });
        this.oSelectionPoint = new TimeSlider.SelectionPoint( this.timeSlider, this.timeSlider.getGroup("selection-point", TimeSlider.GROUP_TYPE.CONTENT_BASE, TimeSlider.oDrawOrder["selection-point"]), {
            "y": this.opt.headerZoneHeight,
            "x": this.timeSlider.oPositionManager.getSelectPosition(),
            "radius": this.opt.selectionPointRadius,
            "height": this.opt.contentZoneHeight,
            "duration": this.opt.duration,
            "eventStartY": this.opt.headerZoneHeight,
            "eventEndY": this.opt.height - this.opt.eventZoneHeight
        });
        this.oLeftHandler = new TimeSlider.Handler( this.timeSlider, this.timeSlider.getGroup("left-handler", TimeSlider.GROUP_TYPE.CONTENT_BASE, TimeSlider.oDrawOrder["left-handler"]), {
            "x": aHandlerPosition[0],
            "zone": [0, aHandlerPosition[1]],
            "height": this.opt.contentZoneHeight,
            "margin": this.opt.margin,
            "duration": 50,//this.opt.duration
            "handleSrc": this.opt.handleSrc
        }, function( x ) {
            self.oLeftTimeSignboard.onDragStart( x );
        }, function( x ) {
            self.oLeftTimeSignboard.onDrag( x );
        }, function( bIsDraged, x ) {
            self.oLeftTimeSignboard.onDragEnd();
            if ( bIsDraged ) {
                self.moveLeftHandler( x );
            }
        });
        this.oRightHandler = new TimeSlider.Handler( this.timeSlider, this.timeSlider.getGroup("right-handler", TimeSlider.GROUP_TYPE.CONTENT_BASE, TimeSlider.oDrawOrder["right-handler"]), {
            "x": aHandlerPosition[1],
            "zone": [ aHandlerPosition[0], this.timeSlider.oPositionManager.getSliderEndPosition() ],
            "height": this.opt.contentZoneHeight,
            "margin": this.opt.margin,
            "duration": 0,//this.opt.duration
            "handleSrc": this.opt.handleSrc
        }, function( x ) {
            self.oRightTimeSignboard.onDragStart( x );
        }, function( x ) {
            self.oRightTimeSignboard.onDrag( x );
        }, function( bIsDraged, x ) {
            self.oRightTimeSignboard.onDragEnd();
            if ( bIsDraged ) {
                self.moveRightHandler( x );
            }
        });
        this.oLeftTimeSignboard = new TimeSlider.TimeSignboard( this.timeSlider, this.timeSlider.getGroup("time-left-signboard", TimeSlider.GROUP_TYPE.CONTENT_BASE, TimeSlider.oDrawOrder["time-signboard"]), {
            "x": aHandlerPosition[0],
            "direction": "left"
        });
        this.oRightTimeSignboard = new TimeSlider.TimeSignboard( this.timeSlider, this.timeSlider.getGroup("time-right-signboard", TimeSlider.GROUP_TYPE.CONTENT_BASE, TimeSlider.oDrawOrder["time-signboard"]), {
            "x": aHandlerPosition[1],
            "direction": "right"
        });
    };
    ts.SelectionManager.prototype.moveLeftHandler = function( x ) {
        var aCurrentSelectionTimeSeries = this.timeSlider.oPositionManager.getSelectionTimeSeries();
        var newLeftTime = this.timeSlider.oPositionManager.getTimeFromPosition( x );
        if ( this.timeSlider.oPositionManager.isInMaxSelectionTimeSeries( newLeftTime, aCurrentSelectionTimeSeries[1] ) ) {
            this.oRightHandler.setZone( x, this.timeSlider.oPositionManager.getSliderEndPosition() );
            this.timeSlider.oPositionManager.setSelectionStartPosition( x );
        } else {
            var aNewSelectionTimeSeries = this.timeSlider.oPositionManager.getNewSelectionTimeSeriesFromStart( newLeftTime );
            var newRightX = this.timeSlider.oPositionManager.getPositionFromTime( aNewSelectionTimeSeries[1] );
            this.oRightHandler.setZone( x, this.timeSlider.oPositionManager.getSliderEndPosition() );
            this.timeSlider.oPositionManager.setSelectionStartPosition( x );
            this.oRightHandler.setX( newRightX );
            this.oRightTimeSignboard.onDrag( newRightX );
            this.oLeftHandler.setZone( 0, newRightX );
            this.timeSlider.oPositionManager.setSelectionEndPosition( newRightX );

            if ( this.timeSlider.oPositionManager.isInSelectionZoneSelectPoint() === false ) {
                this.oSelectionPoint.onMouseClick( newRightX );
                this.timeSlider.fireEvent( "selectTime", aNewSelectionTimeSeries[1] );
            }
        }
        this.oSelectionZone.redraw();
        this._fireChangeZoneEvent();

    };
    ts.SelectionManager.prototype.moveRightHandler = function( x ) {
        var aCurrentSelectionTimeSeries = this.timeSlider.oPositionManager.getSelectionTimeSeries();
        var newRightTime = this.timeSlider.oPositionManager.getTimeFromPosition( x );
        if ( this.timeSlider.oPositionManager.isInMaxSelectionTimeSeries( aCurrentSelectionTimeSeries[0], newRightTime ) ) {
            this.oLeftHandler.setZone( 0, x );
            this.timeSlider.oPositionManager.setSelectionEndPosition( x );
        } else {
            var aNewSelectionTimeSeries = this.timeSlider.oPositionManager.getNewSelectionTimeSeriesFromEnd( newRightTime );
            var newLeftX = this.timeSlider.oPositionManager.getPositionFromTime( aNewSelectionTimeSeries[0] );
            this.oLeftHandler.setZone( 0, x );
            this.timeSlider.oPositionManager.setSelectionEndPosition( x );
            this.oLeftHandler.setX( newLeftX );
            this.oLeftTimeSignboard.onDrag( newLeftX );
            this.oRightHandler.setZone( newLeftX, this.timeSlider.oPositionManager.getSliderEndPosition() );
            this.timeSlider.oPositionManager.setSelectionStartPosition( newLeftX );

            if ( this.timeSlider.oPositionManager.isInSelectionZoneSelectPoint() === false ) {
                this.oSelectionPoint.onMouseClick( newLeftX );
                this.timeSlider.fireEvent( "selectTime", aNewSelectionTimeSeries[0] );
            }
        }
        this.oSelectionZone.redraw();
        this._fireChangeZoneEvent();
    };
    ts.SelectionManager.prototype.moveSelectionAndHandler = function( x ) {
        var aNewSelectionZone = this.timeSlider.oPositionManager.getSelectionPosition();
        this.oLeftHandler.setPositionAndZone( aNewSelectionZone[0], [0, aNewSelectionZone[1] ] );
        this.oRightHandler.setPositionAndZone( aNewSelectionZone[1], [ aNewSelectionZone[0], this.timeSlider.oPositionManager.getSliderEndPosition() ] );
        this.oSelectionZone.redraw();
        this._fireChangeZoneEvent();
    };
    ts.SelectionManager.prototype.onMouseClick = function( event, x, y ) {
        if ( y > this.opt.headerZoneHeight && y < (this.opt.headerZoneHeight + this.opt.contentZoneHeight ) ) {
            this._setSelectTime( this.timeSlider.oPositionManager.getTimeFromPosition(x) );
        }
    };
    ts.SelectionManager.prototype._fireChangeZoneEvent = function() {
        var aNewSelectionZone = this.timeSlider.oPositionManager.getSelectionPosition();
        this.timeSlider.fireEvent( "changeSelectionZone", [ this.timeSlider.oPositionManager.getTimeFromPosition(aNewSelectionZone[0]), this.timeSlider.oPositionManager.getTimeFromPosition(aNewSelectionZone[1]) ] );
    };
    ts.SelectionManager.prototype.setSelectTime = function( time ) {
        var x = this.timeSlider.oPositionManager.getPositionFromTime( time );
        if ( this.timeSlider.oPositionManager.isInSliderTimeSeries( time ) ) {
            this._setSelectTime( time );
        } else {
            this.timeSlider.oPositionManager.resetBySelectTime( time );
            this.timeSlider.reset();
            this.timeSlider.fireEvent( "selectTime", time );
        }
    };
    ts.SelectionManager.prototype._setSelectTime = function( time ) {
        this.timeSlider.oPositionManager.setSelectTime( time );
        if ( this.timeSlider.oPositionManager.isInSelectionZone( this.timeSlider.oPositionManager.getSelectPosition() ) === false ) {
            this.timeSlider.oPositionManager.calcuSelectionZone();
            this.moveSelectionAndHandler();
        }
        this.oSelectionPoint.onMouseClick( this.timeSlider.oPositionManager.getSelectPosition() );
        this.timeSlider.fireEvent( "selectTime", time );
    };
    ts.SelectionManager.prototype.reset = function() {
        var aNewSelectionZone = this.timeSlider.oPositionManager.getSelectionPosition();
        this.oLeftHandler.setPositionAndZone( aNewSelectionZone[0], [0, aNewSelectionZone[1] ] );
        this.oRightHandler.setPositionAndZone( aNewSelectionZone[1], [ aNewSelectionZone[0], this.timeSlider.oPositionManager.getSliderEndPosition() ] );
        this.oSelectionZone.redraw();
        this.oSelectionPoint.onMouseClick( this.timeSlider.oPositionManager.getSelectPosition() );
    };
})(window, jQuery);

(function(w, $) {
    var ts = w.TimeSlider;
    ts.SelectionPoint = function( timeSlider, svgGroup, options ) {
        this.timeSlider = timeSlider;
        this.group = svgGroup;
        this.opt = options;
        this._addElements();
        this.onMouseClick( options.x );
    };
    ts.SelectionPoint.prototype._addElements = function() {
        this.group.add(
            this.timeSlider.snap.line( 0, 0, 0, this.opt.height ),
            this.timeSlider.snap.circle( 0, this.opt.height / 2, this.opt.radius ).attr({
                filter: this.timeSlider.snap.filter( Snap.filter.shadow(0, 0, 2, "#000", 0.3))
            })
        );
    };
    ts.SelectionPoint.prototype.onMouseClick = function( x ) {
        this.group.animate({
            "transform": "translate(" + x +", " + this.opt.y + ")"
        }, this.opt.duration, mina.easein);
    };
})(window, jQuery);

(function(w, $) {
    var ts = w.TimeSlider;
    ts.SelectionZone = function( timeSlider, svgGroup, options ) {
        this.timeSlider = timeSlider;
        this.group = svgGroup;
        this.opt = options;
        this._addElements();
    };
    ts.SelectionZone.prototype._addElements = function() {
        var aSelectionZone = this.timeSlider.oPositionManager.getSelectionPosition();
        this.elZone = this.timeSlider.snap.rect(aSelectionZone[0], this.opt.top, aSelectionZone[1] - aSelectionZone[0], this.opt.height);
        this.group.add(this.elZone);
    };
    ts.SelectionZone.prototype.redraw = function() {
        var aSelectionZone = this.timeSlider.oPositionManager.getSelectionPosition();
        this.elZone.animate({
            "x": aSelectionZone[0],
            "width": aSelectionZone[1] - aSelectionZone[0]
        }, this.opt.duration);
    };
})(window, jQuery);

(function(w, $) {
    var consts = {
        AGENT_CONNECT: 10100,
        AGENT_SHUTDOWN: 10200,
        ID_POSTFIX: "+state-line",
        ID_SPLITER: "+"
    };
    var ts = w.TimeSlider;
    ts.StateLine = function( timeSlider, svgGroup, options ) {
        this.timeSlider = timeSlider;
        this.group = svgGroup;
        this.opt = options;
        this._oEventData = timeSlider.oEventData;

        this._init();
        this._addBaseLine();
        this._addEventElements();
        this._resetBaseLineColor();
    };
    ts.StateLine.prototype._init = function() {
        this._hasDurationData = false;
        this._filterShadow = this.timeSlider.snap.filter( Snap.filter.shadow(0, 1, 0.5, "#000", 0.2));
        this._oLineElementHash = {};
    };
    ts.StateLine.prototype._addBaseLine = function() {
        this._baseColor = TimeSlider.EventColor["base"];
        this._aBaseLine = [ this._makeLine( 0, this.opt.width, this.opt.topLineY, "base", "base-" + Date.now() ), this._makeLine( 0, this.opt.width, this.opt.bottomLineY, "base", "base-" + Date.now() ) ];
        this.group.add( this._aBaseLine[0], this._aBaseLine[1] );
    };
    ts.StateLine.prototype._addEventElements = function( ) {
        var len = this._oEventData.count();
        for( var i = 0 ; i < len ; i++ ) {
            this._addEventElement( this._oEventData.getDataByIndex(i) );
        }
    };
    ts.StateLine.prototype._addEventElement = function( oEvent ) {
        if ( typeof oEvent.durationStartTimestamp !== "undefined" ) {
            if ( this.timeSlider.oPositionManager.isInSliderTimeSeries( oEvent.durationStartTimestamp ) === false && this.timeSlider.oPositionManager.isInSliderTimeSeries( oEvent.durationEndTimestamp ) === false ) return;
            this._hasDurationData = true;
            this._addLine(
                this.timeSlider.oPositionManager.getPositionFromTime( oEvent.durationStartTimestamp ),
                this._getX2( oEvent ),
                oEvent
            );
        }
    };
    ts.StateLine.prototype._makeID = function( oEvent ) {
        return this._oEventData.makeID( oEvent ) + consts.ID_POSTFIX;
    };
    ts.StateLine.prototype._addLine = function( x, x2, oEvent ) {
        var lineID = this._makeID( oEvent );
        var elLineTop = this._makeLine( x, x2, this.opt.topLineY, oEvent.eventTypeCode, lineID );
        var elLineBottom = this._makeLine( x, x2, this.opt.bottomLineY, oEvent.eventTypeCode, lineID );
        this._oLineElementHash[lineID] = [ elLineTop, elLineBottom ];
        this.group.add( elLineTop, elLineBottom );
    };
    ts.StateLine.prototype._makeLine = function( x, x2, y, eventType, id ) {
        return  this.timeSlider.snap.line( x, y, x2, y ).attr({
            //"filter": this._filterShadow,
            "stroke": TimeSlider.EventColor[eventType],
            "data-id": id,
            "strokeWidth": this.opt.thickness
        });
    };
    ts.StateLine.prototype._hasEventData = function( id ) {
        return typeof this._oLineElementHash[id] === "undefined" ? false : true;
    };
    ts.StateLine.prototype._getX2 = function( oEvent ) {
        return this.timeSlider.oPositionManager.getPositionFromTime( oEvent.durationEndTimestamp == -1 ? this.timeSlider.oPositionManager.getSliderEndTime() : oEvent.durationEndTimestamp );
    };
    ts.StateLine.prototype.changeData = function() {
        var len = this._oEventData.count();
        for( var i = 0 ; i < len ; i++ ) {
            var oEvent = this._oEventData.getDataByIndex(i);
            if ( this._hasEventData( this._makeID( oEvent ) ) === false ) {
                this._addEventElement( oEvent );
            }
        }
        this.reset();
    };
    ts.StateLine.prototype.emptyData = function() {
        for( var p in this._oLineElementHash ) {
            var aLine = this._oLineElementHash[p];
            aLine[0].remove();
            aLine[1].remove();
        }
        this._oLineElementHash = {};
    };
    ts.StateLine.prototype.setDefaultStateLineColor = function( color ) {
        this._baseColor = color;
        if ( this._hasDurationData === true ) return;
        this._aBaseLine.forEach(function( elLine ) {
            elLine.attr("stroke", color);
        });
    };
    ts.StateLine.prototype._resetBaseLineColor = function() {
        var self = this;
        this._aBaseLine.forEach(function( elLine ) {
            elLine.attr("stroke", self._hasDurationData === true ? TimeSlider.EventColor["base"] : self._baseColor );
        });
    };
    ts.StateLine.prototype.reset = function() {
        var self = this;
        var oPM = this.timeSlider.oPositionManager;
        for( var p in this._oLineElementHash ) {
            var aLine = this._oLineElementHash[p];
            var oEvent = this._oEventData.getDataByKey(p.split(consts.ID_SPLITER)[0]);
            if ( oPM.isInSliderTimeSeries( oEvent.durationStartTimestamp ) || oPM.isInSliderTimeSeries( oEvent.durationEndTimestamp ) ) {
                aLine.forEach(function( elLine ) {
                    self.show( elLine );
                    elLine.animate({
                        "x1": oPM.getPositionFromTime( oEvent.durationStartTimestamp ),
                        "x2": self._getX2( oEvent )
                    }, self.opt.duration);
                });
            } else {
                aLine.forEach(function( elLine ) {
                    self.hide( elLine );
                });
            }
        }
        this._aBaseLine.forEach(function( elBase ) {
            elBase.animate({
                "x2": oPM.getSliderEndPosition()
            }, self.opt.duration);
        });
        this._resetBaseLineColor();
    };
    ts.StateLine.prototype.show = function( el ) {
        el.attr("display", "block");
    };
    ts.StateLine.prototype.hide = function( el ) {
        el.attr("display", "none");
    };
})(window, jQuery);

(function(w, $) {
    var ts = w.TimeSlider;
    ts.TimeSeriesSignboard = function( timeSlider, svgGroup, options ) {
        this.timeSlider = timeSlider;
        this.group = svgGroup;
        this.opt = options;
        this._init();
        this._addElements();
    };
    ts.TimeSeriesSignboard.prototype._init = function() {
        this._halfHeight = this.opt.height - 12;
    };
    ts.TimeSeriesSignboard.prototype._addElements = function() {
        this._elStartTime = this.group.text(0, this._halfHeight, this.timeSlider.oPositionManager.getSliderStartTimeStr() ).attr({
            "text-anchor": "start"
        });
        this._elEndTime = this.group.text(this.timeSlider.oPositionManager.getSliderEndPosition(), this._halfHeight, this.timeSlider.oPositionManager.getSliderEndTimeStr() ).attr({
            "text-anchor": "end"
        });
        this.group.add( this._elStartTime, this._elEndTime );
    };
    ts.TimeSeriesSignboard.prototype.reset = function() {
        this._elStartTime.attr("text", this.timeSlider.oPositionManager.getSliderStartTimeStr() );
        this._elEndTime.attr("text", this.timeSlider.oPositionManager.getSliderEndTimeStr() );
    };
    ts.TimeSeriesSignboard.prototype.resize = function() {
        var self = this;
        this._elEndTime.animate({
            "x": self.timeSlider.oPositionManager.getSliderEndPosition()
        }, this.opt.duration, function() {
            self._elEndTime.attr("text", self.timeSlider.oPositionManager.getSliderEndTimeStr() );
        });
    };
})(window, jQuery);

(function(w, $) {
    var ts = w.TimeSlider;
    ts.TimeSignboard = function( timeSlider, svgGroup, options ) {
        this.timeSlider = timeSlider;
        this.group = svgGroup;
        this.opt = options;
        this._textMaxWidth = 100;
        this._xPadding = 2;
        this._addElements();
    };
    ts.TimeSignboard.prototype._addElements = function() {
        var isIn = this._isIn( this.opt.x );
        var x = this.opt.x + ( isIn ? this._xPadding : -this._xPadding );
        this.timeText = this.group.text(x, 26, this.timeSlider.oPositionManager.getFullTimeStr(this.opt.x) ).attr({
            "textAnchor": isIn ? "start" : "end"
        });
        this.group.add( this.timeText );
    };
    ts.TimeSignboard.prototype.setX = function( x ) {
        var isIn = this._isIn( x );
        this.timeText.attr({
            "x": x + ( isIn ? this._xPadding : -this._xPadding ),
            "text": this.timeSlider.oPositionManager.getFullTimeStr(x),
            "textAnchor": isIn ? "start" : "end"
        });

    };
    ts.TimeSignboard.prototype._isIn = function( x ) {
        if ( this.opt.direction == "left" ) {
            return x < this._textMaxWidth;
        } else {
            return x + this._textMaxWidth < this.timeSlider.oPositionManager.getSliderEndPosition();
        }
    };
    ts.TimeSignboard.prototype.onDragStart = function( x ) {
        this.setX( x );
    };
    ts.TimeSignboard.prototype.onDragEnd = function() {
    };
    ts.TimeSignboard.prototype.onDrag = function( x ) {
        this.setX( x );
    };
})(window, jQuery);

(function(w, $) {
    w.TimeSlider.XAxis = function( timeSlider, svgGroup, options ) {
        this.timeSlider = timeSlider;
        this.group = svgGroup;
        this.opt = options;
        this.aSubGroup = [];
        this.aText = [];
        this.init();
    };
    w.TimeSlider.XAxis.prototype.init = function() {
        var aXBarPosition = this.timeSlider.oPositionManager.getXBarPosition();
        var halfX = this.opt.width / 2;
        var self = this;
        for( var i = 0 ; i < aXBarPosition.length ; i++ ) {
            var g = self.group.g();
            self.aText.push( self.timeSlider.snap.text(0, self.opt.textY, aXBarPosition[i].time) );
            g.attr("transform", "translate(" + halfX + ", 0)");
            g.add(
                self.aText[i],
                self.timeSlider.snap.line(0, self.opt.startY, 0, self.opt.endY)
            );
            self.group.add( g );
            self.aSubGroup.push( g );
            self.setX( i, aXBarPosition[i].x, halfX );
        }
    };
    w.TimeSlider.XAxis.prototype.setX = function( index, x, startX ) {
        var ele = this.aSubGroup[index];
        if ( arguments.length === 3 ) {
            Snap.animate( startX, x, function( val ) {
                ele.attr("transform", "translate(" + val + ", 0)");
            }, this.opt.duration);
        } else {
            ele.attr("transform", "translate(" + x + ", 0)");
        }
    };
    w.TimeSlider.XAxis.prototype.reset = function() {
        var self = this;
        var aYBarPosition = this.timeSlider.oPositionManager.getXBarPosition();
        var halfX = this.opt.width / 2;
        for ( var i = 0 ; i < aYBarPosition.length ; i++ ) {
            self.aSubGroup[i].attr( "transform", "translate(" + aYBarPosition[i].x + ",0)");
            self.aText[i].attr("text", aYBarPosition[i].time );
        }
    };
})(window, jQuery);

/*! pinpoint - v1.5.2 - 2016-03-15 */(function(global, $) {
	'use strict';
	function BigScatterChart2( htOption, aAgents, aPlugins, oExternal, agentAllStr ) {
		this._oExternal = oExternal;
		this._AGENT_ALL = this._currentAgent = agentAllStr;
		this._aAgentList = aAgents;

		this._setOption( htOption );
		this._initVariables();
		this._initManager();
		this._initElements();
		this._initPlugin( aPlugins );
		this._initInnerPlugin();
	}
	BigScatterChart2.prototype.option = function( v, v2 ) {
		var self = this;
		var argLen = arguments.length;
		if ( argLen === 2 ) {
			this._option[v] = v2;
		} else if ( argLen === 1 ) {
			if ( typeof v === "object" ) {
				this._option = this._option || {};
				for( var p in v ) {
					self._option[p] = v[p];
				}
			} else if ( typeof v === "string" ) {
				return this._option[v];
			}
		} else {
			return this._option;
		}
	};
	BigScatterChart2.prototype._setOption = function( htOption ) {
		this.option({
			"containerId": "",
			"sPrefix": "bigscatterchart",
			"width": 600,
			"height": 400,
			"minX": 0, "maxX": 100,
			"minY": 0, "maxY": 100,
			"minZ": 0, "maxZ": 1,
			"ticksOfX": 5,
			"ticksOfY": 5,
			"bubbleSize": 10,
			"padding" : {
				"top": 40,
				"left": 50,
				"right": 40,
				"bottom": 30
			},
			"lineColor": "#3d3d3d",
			"bubbleRadius": 3,
			"guideStyle": {
				"lineWidth": 1,
				"lineDash": [1, 0],
				"globalAlpha": 1,
				"strokeStyle" : "#e3e3e3"
			},
			//"sXLabel": "",
			//"sYLabel": "",
			"axisLabelStyle": {
				"font-size": "10px",
				"line-height": "12px",
				"height": "20px",
				"padding-top": "5px"
			},
			"loadingStr": "Loading",
			"noDataStr": "No Data",
			"noDataStyle": {
				"font-size": "15px",
				"color": "#000",
				"font-weight": "bold"
			},
			"bUseMouseGuideLine" : true,
			"checkBoxImage": {
				"checked": "data:image/gif;base64,R0lGODlhDgANANU7APf6/QBoAO31+wBEAABZABSmDfj7/kLFLM/k9CpFeCA7bBs1ZiU/cWDZQBgxYvL4/PD2/ABLAKzQ6wBTAPn8/vD3/FLPNgBzAO30/J/J6JKgu1/YPzBLfzVQhQBvAO31/EhknURgmNTn9NPm9Orz+9fc51LQNztWjfX5/e/2++72+9vh7Njp9kBbk9jp9aCvzd3r+QB3AABhAKXM6SGvFTG5IEtnoBUuXuLu+v//zP///wAAAAAAAAAAAAAAAAAAACH5BAEAADsALAAAAAAOAA0AAAaHwJ1tSCS+VrsdSMdsOmOxXUiHq1ohlFguF2vpMAYDBvYxXDaNxuWkA3gCABIgYLGYAruOTraVoWQHgTIlOxw6BDWJiIoUGjsJOg8TNJSUEw8QCTsMOiwVEQWhERUuOAw7CjoSIykDrioiEjgKOws6MzMIArsIuDgLOw4ZVsRWDkk3ycrLN0lBADs=",
				"unchecked": "data:image/gif;base64,R0lGODlhDgANAPcbANnZ2X9/f3Nzc4eHh4ODg5GRkfDw8IqKim1tbXt7e46Ojnd3d3BwcOzs7NPT09jY2O/v7+3t7eHh4eXl5dXV1enp6d3d3Wtra5OTk/Ly8v///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS4wLWMwNjEgNjQuMTQwOTQ5LCAyMDEwLzEyLzA3LTEwOjU3OjAxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1LjEgTWFjaW50b3NoIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjYxQjZBNkRCQUVEQTExRTI5Q0M1REU5NjlFRThGRDZBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjYxQjZBNkRDQUVEQTExRTI5Q0M1REU5NjlFRThGRDZBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NjFCNkE2RDlBRURBMTFFMjlDQzVERTk2OUVFOEZENkEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NjFCNkE2REFBRURBMTFFMjlDQzVERTk2OUVFOEZENkEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4B//79/Pv6+fj39vX08/Lx8O/u7ezr6uno5+bl5OPi4eDf3t3c29rZ2NfW1dTT0tHQz87NzMvKycjHxsXEw8LBwL++vby7urm4t7a1tLOysbCvrq2sq6qpqKempaSjoqGgn56dnJuamZiXlpWUk5KRkI+OjYyLiomIh4aFhIOCgYB/fn18e3p5eHd2dXRzcnFwb25tbGtqaWhnZmVkY2JhYF9eXVxbWllYV1ZVVFNSUVBPTk1MS0pJSEdGRURDQkFAPz49PDs6OTg3NjU0MzIxMC8uLSwrKikoJyYlJCMiISAfHh0cGxoZGBcWFRQTEhEQDw4NDAsKCQgHBgUEAwIBAAAh+QQBAAAbACwAAAAADgANAAAIgwA3YBhIsCCGDRsKaFjIsGGGAhsUaMhAsaJFBRsOaIDAkaMBAxwzHNgwQEOEkygbnMwwYAMBDRViypSZgcCGABom6Ny5M0OADQk0SBhKlGiGBBsWaLDAtGnTDAs2CNDw4AEAq1WvZhCwgYEGCmDDhs3AYAMCBxbTZkCA8ILbt3AvIAwIADs="
			},
			"fnXAxisFormat": function ( tickX, i, minX ) {
				var oMoment = moment( tickX * i + minX );
				return oMoment.format( "MM-DD" ) + "<br>" + oMoment.format( "HH:mm:ss" );
			},
			"fnYAxisFormat": function ( tickY, i, minY, maxY ) {
				return BigScatterChart2.Util.addComma(( maxY + minY ) - (( tickY * i ) + minY ));
			},
			"fOnSelect": function() {}
		});
		this.option(htOption);
		this.option( "minY", this._oExternal.loadFromStorage( "scatter-y-min" ) || this.option("minY") );
		this.option( "maxY", this._oExternal.loadFromStorage( "scatter-y-max" ) || this.option("maxY") );
	};
	BigScatterChart2.prototype._initVariables = function() {
		this._aBubbles = [];
		this._oSCManager = new BigScatterChart2.SizeCoordinateManager( this.option() );
		this._bPause = false;
		this._bDestroied = false;
		this._bRequesting = false;
		this._getContainer();
	};
	BigScatterChart2.prototype._getContainer = function() {
		var vContainer = this.option( "containerId" );
		switch( typeof vContainer ) {
			case "string":
				this._$elContainer = $("#" + vContainer);
				break;
			case "object":
				this._$elContainer = vContainer;
				break;
			case "function":
				this._$elContainer = vContainer();
				break;
		}
		this._$elContainer = $( this._$elContainer );
		this._$elContainer.css({
			"width": this._oSCManager.getWidth(),
			"height": this._oSCManager.getHeight(),
			"position": "relative"
		}).addClass( this.option( "containerClass" ) );
	};
	BigScatterChart2.prototype._initManager = function() {
		var self = this;

		this._oBubbleTypeManager = new BigScatterChart2.BubbleTypeManager( this.option(), this._oSCManager, this._$elContainer, {
			"onChange": function( type ) {
				self._oRendererManager.toggle( type );
			},
			"onSend": function( type, bChecked ) {
				self._oExternal.sendAnalytics( type, bChecked );
			}
		});
		this._oRendererManager = new BigScatterChart2.RendererManager( this.option(), this._oSCManager, this._aAgentList, this._$elContainer );
		this._oDragManager = new BigScatterChart2.DragManager( this.option(), this._oSCManager, this._$elContainer, {
			"onSelect": function( oDragAreaPosition, oDragXY ) {
				if ( self.hasDataByXY( oDragXY.fromX, oDragXY.toX, oDragXY.fromY, oDragXY.toY ) ) {
					self._oExternal.onSelect( oDragAreaPosition, oDragXY );
				}
			}
		});
	};
	BigScatterChart2.prototype._initElements = function() {
		this._$elPluginArea = $("<div>").css({
			"top": "0px",
			"left": this._oSCManager.getLeftOfPluginArea() + "px",
			"width": this._oSCManager.getPadding().right + "px",
			"height": this._oSCManager.getHeight() + "px",
			"z-index": 510,
			"position": "absolute"
		}).addClass( "plugins" ).appendTo( this._$elContainer );
	};
	BigScatterChart2.prototype._initPlugin = function( aPluginList ) {
		var self = this;
		$.each( aPluginList, function( index, oPlugin ) {
			oPlugin.initElement( self._$elContainer, self._$elPluginArea, self.option() ).initEvent( self );
		});
	};
	BigScatterChart2.prototype._initInnerPlugin = function() {
		this._oMessage = new BigScatterChart2.MessagePlugin();
		this._oMessage.initElement( this._$elContainer, this._$elPluginArea, this.option() ).initEvent( self );
	};
	BigScatterChart2.prototype.fireDragEvent = function( oParam ) {
		this._oDragManager.triggerDrag( oParam );
	};
	BigScatterChart2.prototype.selectArea = function( type, min, max ) {
		this._oExternal.onSelect( type, min, max );
	};
	BigScatterChart2.prototype.selectType = function( type ) {
		this._oBubbleTypeManager.selectType( type );
		this._oRendererManager.selectType( this._currentAgent, type );
		return this;
	};
	BigScatterChart2.prototype.addBubbles = function( oDataBlock ) {
		this._aBubbles.push( oDataBlock );
	};
	BigScatterChart2.prototype._getSumCountByType = function( bRealtime ) {
		var self = this;
		var oSum = {};
		var oRangeX = this._oSCManager.getX();
		$.each( this.option( "typeInfo" ), function( key, oValue ) {
			oSum[oValue[0]] = 0;
		});
		for( var i = 0 ; i < this._aBubbles.length ; i++ ) {
			var oDataBlock = this._aBubbles[i];
			$.each( this._aAgentList, function( index,  agentName ) {
				if ( self._currentAgent === self._AGENT_ALL || self._currentAgent === agentName ) {
					$.each( oSum, function( type ) {
						//if ( self._oBubbleTypeManager.isChecked( type ) ) {
						if ( bRealtime === true ) {
							oSum[type] += oDataBlock.getCount( agentName, type, oRangeX.min, oRangeX.max );
						} else {
							oSum[type] += oDataBlock.getCount( agentName, type );
						}

						//}
					});
				}
			});
		}
		return oSum;
	};
	BigScatterChart2.prototype.redrawBubbles = function() {
		this._oBubbleTypeManager.showTypeCount( this._getSumCountByType() );

		if (this._aBubbles.length > 0) {
			this._oMessage.hide();
		}
		for (var i = 0, nLen = this._aBubbles.length; i < nLen; i++) {
			this._drawBubbles( this._aBubbles[i] );
		}
	};
	BigScatterChart2.prototype.clear = function() {
		this._oRendererManager.clear();
		this._aBubbles = [];
		this._oBubbleTypeManager.showTypeCount( this._getSumCountByType() );
		this._oDragManager.hide();
		this._oMessage.show( this.option( "noDataStr" ) );
	};
	BigScatterChart2.prototype._drawBubbles = function( oDataBlock ) {
		var self = this;
		var oTypeInfo = this.option("typeInfo");
		var oPropertyIndex = this.option( "propertyIndex" );
		var sPrefix = this.option("sPrefix");

		setTimeout(function () {
			$.each(self._aAgentList, function (index, agentName) {
				for (var i = 0, nLen = oDataBlock.countByAgent( agentName ); i < nLen && !self._bDestroied; i++) {
					var aAgentBubbleData = oDataBlock.getDataByAgent(agentName, i);
					var groupCount = aAgentBubbleData[oPropertyIndex.groupCount];
					if ( groupCount !== 0 ) {
						var aBubbleType = oTypeInfo[aAgentBubbleData[oPropertyIndex.type]];
						self._oRendererManager.drawBubble( BigScatterChart2.Util.makeKey( agentName, sPrefix, aBubbleType[0] ), aBubbleType[1], aAgentBubbleData );
					}
				}

			});
		}, 0);
	};
	BigScatterChart2.prototype.addBubbleAndMoveAndDraw = function( oDataBlock, bRealtime, nextRequestTime ) {
		if ( bRealtime === false ) {
			if ( oDataBlock.isEmpty() ) {
				return;
			} else {
				this._oMessage.hide();
			}
		}
		this.addBubbles( oDataBlock );
		this._oBubbleTypeManager.showTypeCount( this._getSumCountByType( bRealtime ) );
		this._drawBubbles( oDataBlock );
		this._moveChart( oDataBlock, nextRequestTime );
		this._oRendererManager.updateXYAxis();
		this._removeBubble();
	};
	BigScatterChart2.prototype._moveChart = function( oDataBlock, nextRequestTime ) {
		var oRangeX = this._oSCManager.getX();
		var oDataBlockRangeX = oDataBlock.getX();
		var animationTime = this.option( "chartAnimationTime" );

		if ( oDataBlockRangeX.min >= oRangeX.max ) {
			var moveXTime = oDataBlockRangeX.max - oRangeX.max;
			var moveXValue = moveXTime * this._oSCManager.getPixelPerTime();
			this._oSCManager.setX( oRangeX.min + moveXTime, oRangeX.max + moveXTime );
			this._oRendererManager.moveChart( parseInt( moveXValue, 10 ), nextRequestTime < animationTime ? 0 : animationTime ); // 300 or 0
		}
	};
	BigScatterChart2.prototype._removeBubble = function() {
		var minX = this._oSCManager.getX().min;

		for( var i = 0 ; i < this._aBubbles.length ; i++ ) {
			var oDataBlock = this._aBubbles[i];
			if ( oDataBlock.getX().max < minX ) {
				this._aBubbles.shift();
				i--;
			} else {
				break;
			}
		}
	};
	BigScatterChart2.prototype.createDataBlock = function( oData ) {
		return new BigScatterChart2.DataBlock( oData, this.option( "propertyIndex" ), this.option( "typeInfo" ) );
	};
	BigScatterChart2.prototype.getDataByXY = function( fromX, toX, fromY, toY ) {
		var aData = [];
		var oTypeInfo = this.option( "typeInfo" );
		var oPropertyIndex = this.option( "propertyIndex" );

		fromX = parseInt(fromX, 10);
		toX = parseInt(toX, 10);
		fromY = parseInt(fromY, 10);
		toY = parseInt(toY, 10);

		var oRangeY = this._oSCManager.getY();
		var aVisibleType = this._oBubbleTypeManager.getVisibleType();

		for (var i = 0, nLen = this._aBubbles.length; i < nLen; i++) {
			var oDataBlock = this._aBubbles[i];
			for (var j = 0, nLen2 = oDataBlock.count() ; j < nLen2; j++ ) {
				var aBubbleData = oDataBlock.getData( j );
				var agentName = oDataBlock.getAgentName( aBubbleData );
				if ( this._currentAgent === this._AGENT_ALL || this._currentAgent === agentName  ) {
					var bubbleX = aBubbleData[oPropertyIndex.x];
					var bubbleType = oTypeInfo[aBubbleData[oPropertyIndex.type]][0];
					if ( BigScatterChart2.Util.isInRange( fromX, toX, bubbleX ) && BigScatterChart2.Util.indexOf( aVisibleType, bubbleType ) >= 0) {
						var bubbleY = aBubbleData[oPropertyIndex.y];
						if ( BigScatterChart2.Util.isInRange( fromY, toY, bubbleY ) || toY === oRangeY.max && toY < bubbleY ) {
							aData.push( [
								oDataBlock.getTransactionID( aBubbleData ),
								aBubbleData[oPropertyIndex.x],
								aBubbleData[oPropertyIndex.y]
							]);
						}
					}
				}

			}
		}
		return aData;
	};
	BigScatterChart2.prototype.getDataByRange = function( type, fromY, toY ) {
		var aData = [];
		var oTypeInfo = this.option( "typeInfo" );
		var oPropertyIndex = this.option( "propertyIndex" );

		fromY = parseInt(fromY, 10);
		toY = parseInt(toY, 10);

		for (var i = 0, nLen = this._aBubbles.length; i < nLen; i++) {
			var oDataBlock = this._aBubbles[i];
			for (var j = 0, nLen2 = oDataBlock.count() ; j < nLen2; j++ ) {
				var aBubbleData = oDataBlock.getData( j );
				var agentName = oDataBlock.getAgentName( aBubbleData );
				if ( this._currentAgent === this._AGENT_ALL || this._currentAgent === agentName  ) {
					var bubbleType = oTypeInfo[aBubbleData[oPropertyIndex.type]][0];
					if ( type === bubbleType ) {
						var bubbleY = aBubbleData[oPropertyIndex.y];
						if ( type === "Failed" || BigScatterChart2.Util.isInRange( fromY, toY, bubbleY ) ) {
							aData.push( [
								oDataBlock.getTransactionID( aBubbleData ),
								aBubbleData[oPropertyIndex.x],
								aBubbleData[oPropertyIndex.y]
							]);
						}
					}
				}
			}
		}
		return aData;
	};
	BigScatterChart2.prototype.hasDataByXY = function( fromX, toX, fromY, toY ) {
		var oTypeInfo = this.option( "typeInfo" );
		var oPropertyIndex = this.option( "propertyIndex" );

		fromX = parseInt(fromX, 10);
		toX = parseInt(toX, 10);
		fromY = parseInt(fromY, 10);
		toY = parseInt(toY, 10);

		var oRangeY = this._oSCManager.getY();
		var aVisibleType = this._oBubbleTypeManager.getVisibleType();

		for (var i = 0, nLen = this._aBubbles.length; i < nLen; i++) {
			var oDataBlock = this._aBubbles[i];
			for (var j = 0, nLen2 = oDataBlock.count() ; j < nLen2; j++ ) {
				var aBubbleData = oDataBlock.getData( j );
				var agentName = oDataBlock.getAgentName( aBubbleData );
				if ( this._currentAgent === this._AGENT_ALL || this._currentAgent === agentName  ) {
					var bubbleX = aBubbleData[oPropertyIndex.x];
					var bubbleType = oTypeInfo[aBubbleData[oPropertyIndex.type]][0];
					if ( BigScatterChart2.Util.isInRange( fromX, toX, bubbleX ) && BigScatterChart2.Util.indexOf( aVisibleType, bubbleType ) >= 0) {
						var bubbleY = aBubbleData[oPropertyIndex.y];
						if ( BigScatterChart2.Util.isInRange( fromY, toY, bubbleY ) || toY === oRangeY.max && toY < bubbleY ) {
							return true;
						}
					}
				}
			}
		}
		return false;
	};
	//BigScatterChart2.prototype.destroy = function() {
	//	var self = this;
	//	this._unbindAllEvents();
	//	//this._empty();
	//	$.each(this, function (property, content) {
	//		delete self[property];
	//	});
	//	this._bDestroied = true;
	//
	//};
	//BigScatterChart2.prototype._empty = function() {
	//	this._$elContainer.empty();
	//};
	//BigScatterChart2.prototype._unbindAllEvents = function() {
	//	// this is for drag-selecting. it should be unbinded.
	//	jQuery(document).unbind("mousemove").unbind("mouseup");
	//};
	BigScatterChart2.prototype.getChartAsImage = function( type ) {
		return this._oRendererManager.getChartAsImage( type, this._oBubbleTypeManager.getElementLI() );
	};
	BigScatterChart2.prototype.drawWithDataSource = function( oDataLoadManager ) {
		this._oDataLoadManager = oDataLoadManager;
		this._oDataLoadManager.setTimeManager( this._oSCManager );
		this._oDataLoadManager.abort();
		this._oDataLoadManager.initCallCount();
		this._drawWithDataSource();
		if ( this.option( "realtime" ) ) {
			this._invokeLoadRealtimeData();
		}
	};
	BigScatterChart2.prototype._invokeLoadRealtimeData = function() {
		var self = this;
		setTimeout(function() {
			self._drawWithRealtimeDataSource();
		}, this._oDataLoadManager.getRealtimeInterval() );
	};
	BigScatterChart2.prototype._drawWithDataSource = function() {
		var self = this;
		if (this._bPause || this._bRequesting || this._oDataLoadManager.isCompleted() ) {
			return;
		}
		if ( this._oDataLoadManager.isFirstRequest() ) {
			this._oMessage.show( this.option( "loadingStr" ) );
		}
		this._oDataLoadManager.loadData( function() {
			self._bRequesting = false;
		}, function( oResultData, bHasNextData, intervalTime ) {

			var oDataBlock = self.createDataBlock( oResultData );
			if ( oDataBlock.isEmpty() === false ) {
				self.addBubbleAndMoveAndDraw( oDataBlock, false, 0 );
			}
			if ( bHasNextData === true ) {
				setTimeout(function () {
					self._drawWithDataSource();
				}, intervalTime );
			} else if (!self._aBubbles || self._aBubbles.length === 0) {
				self._oMessage.show( self.option( "noDataStr" ) );
			}
		}, function() {
			self._showServerError();
			self._oExternal.onError();
		}, this._oSCManager.getXOfPixel(), this._oSCManager.getYOfPixel()
		);
		this._bRequesting = true;
	};
	BigScatterChart2.prototype._drawWithRealtimeDataSource = function() {
		var self = this;
		this._oDataLoadManager.loadRealtimeData( function( oResultData, nextRequestTime, bResetRealtime, currentServerTime ) {
			self._hideServerError();
			if ( bResetRealtime ) {
				self.pause();
				self.resume( currentServerTime - self._oSCManager.getGapX(), currentServerTime );
			} else {
				self.addBubbleAndMoveAndDraw( self.createDataBlock( oResultData ), true, nextRequestTime );
				setTimeout(function () {
					if( self._bPause === false ) {
						self._drawWithRealtimeDataSource();
					}
				}, nextRequestTime );
			}
		}, function() {
			self._showServerError();
			self._oExternal.onError();
			setTimeout(function () {
				if( self._bPause === false ) {
					self._drawWithRealtimeDataSource();
				}
			}, 0 );
		}, this._oSCManager.getXOfPixel(), this._oSCManager.getYOfPixel() );
	};
	BigScatterChart2.prototype._hideServerError = function() {
		this._$elContainer.css({
			"backgroundImage": "none"
		});
	};
	BigScatterChart2.prototype._showServerError = function() {
		this._$elContainer.css({
			"backgroundImage": "url(" + this.option( "errorImage" ) + ")",
			"backgroundRepeat": "no-repeat",
			"backgroundPosition": "88% 21%",
			"backgroundSize": "30px 30px"
		});
	};
	BigScatterChart2.prototype.redraw = function() {
		this._oRendererManager.clear();
		this._oRendererManager.updateXYAxis();
		this.redrawBubbles();
	};
	BigScatterChart2.prototype.abort = function() {
		this._bPause = true;
		this._oDataLoadManager.abort();
	};
	BigScatterChart2.prototype.pause = function() {
		this._bPause = true;
		if ( this.option( "realtime" ) ) {
			this._oRendererManager.reset();
		}
	};
	BigScatterChart2.prototype.resume = function( from, to ) {
		this._bPause = false;
		if ( this.option( "realtime" ) ) {
			this._aBubbles = [];
			this._oSCManager.setX( from, to, true );
			this._oDataLoadManager.reset();
			this._oDataLoadManager.setRealtimeFrom( to );
			this._oRendererManager.updateXYAxis();
			this._drawWithDataSource();
			this._invokeLoadRealtimeData();
		} else {
			this._drawWithDataSource();
		}
	};
	BigScatterChart2.prototype.changeRangeOfY = function( oNewRangeY ) {
		this._oSCManager.setY( oNewRangeY.min, oNewRangeY.max );
	};
	BigScatterChart2.prototype.selectAgent = function( agentName, bInitCheck ) {
		var self = this;
		var bIsAll = ( agentName === this._AGENT_ALL );
		var aBubbleTypeInfo = this.option("typeInfo");
		var oTypeCheckInfo = {};

		if ( bInitCheck === true) {
			this._oBubbleTypeManager.selectAll();
			$.each( aBubbleTypeInfo, function( key, aValue ) {
				oTypeCheckInfo[ aValue[0] ] = true;
			});
		} else {
			$.each( aBubbleTypeInfo, function( index, aValue ) {
				oTypeCheckInfo[ aValue[0] ] = self._oBubbleTypeManager.isChecked( aValue[0] );
			});
		}
		this._currentAgent = agentName;
		this._oRendererManager.showSelectedAgent( bIsAll, agentName, oTypeCheckInfo );
		this._oBubbleTypeManager.showTypeCount( this._getSumCountByType() );
	};
	BigScatterChart2.prototype.getCurrentAgent = function() {
		return this._currentAgent;
	};


	global.BigScatterChart2 = BigScatterChart2;
})(window, jQuery);
(function(global, $) {
	'use strict';
	function DataBlock( oData, oPropertyIndex, oTypeInfo ) {
		this._initData( oData );
		this._splitDataByAgent( oPropertyIndex, oTypeInfo );
	}
	DataBlock.prototype._initData = function( oData ) {
		this._from = oData.from;
		this._to = oData.to;
		this._resultFrom = oData.complete ? oData.from : oData.resultFrom;
		this._resultTo = oData.complete ? oData.to : oData.resultTo;
		this._oAgentMetaInfo = oData.scatter.metadata;
		this._aAllData = oData.scatter.dotList;
		this._bLoadComplete = oData.complete;

		this._oAgentData = {};
		this._oCountOfType = {};
	};
	DataBlock.prototype._splitDataByAgent = function( oPropertyIndex, oTypeInfo ) {
		var self = this;
		this._oPropertyIndex = oPropertyIndex;
		this._oTypeInfo = oTypeInfo;
		$.each( this._oAgentMetaInfo, function( key, oValue ) {
			var agentName = oValue[0];
			self._oAgentData[agentName] = [];
			self._oCountOfType[agentName] = {};
			$.each( oTypeInfo, function( key, aValue ) {
				self._oCountOfType[agentName][aValue[0]] = 0;
			});
		});
		var minY = Number.MAX_VALUE;
		var maxY = 0;

		$.each( this._aAllData, function( index, aValue ) {
			var agentName = self._getAgentName( aValue[2] + "" );
			minY = Math.min( aValue[1], minY );
			maxY = Math.max( aValue[1], maxY );
			aValue[0] += self._from;
			self._oAgentData[ agentName ].push( aValue );
			self._oCountOfType[agentName][ oTypeInfo[aValue[oPropertyIndex.type] + "" ][0] ]++;
		});

		this._minX = this._bLoadComplete ? this._from : this._resultFrom;
		this._maxX = this._bLoadComplete ? this._to : this._resultTo;
		this._minY = minY;
		this._maxY = maxY;
	};
	DataBlock.prototype._getAgentName = function( key ) {
		return this._oAgentMetaInfo[ key ][0];
	};
	DataBlock.prototype.getDataByAgent = function( agent, index ) {
		return this._oAgentData[agent][index];
	};
	DataBlock.prototype.getData = function( index ) {
		return this._aAllData[index];
	};
	DataBlock.prototype.count = function() {
		return this._aAllData.length;
	};
	DataBlock.prototype.countByAgent = function( agent ) {
		if ( this._oAgentData[agent] ) {
			return this._oAgentData[agent].length;
		} else {
			return 0;
		}
	};
	DataBlock.prototype.getCount = function( agentName, type, minX, maxX ) {
		if ( arguments.length === 2 ) {
			if (this._oCountOfType[agentName]) {
				return this._oCountOfType[agentName][type];
			} else {
				return 0;
			}
		} else {
			return this._getRealtimeCount( agentName, type, minX, maxX );
		}
	};
	DataBlock.prototype._getRealtimeCount = function( agentName, type, minX, maxX ) {
		var self = this;
		var sum = 0;
		$.each( this._aAllData, function( index, aValue ) {
			if ( agentName === self._getAgentName( aValue[self._oPropertyIndex.meta] + "" ) ) {
				if ( type === self._oTypeInfo[aValue[self._oPropertyIndex.type] + ""][0] ) {
					if ( aValue[self._oPropertyIndex.x] >= minX && aValue[self._oPropertyIndex.x] <= maxX ) {
						sum++;
					}
				}
			}
		});
		return sum;
	};
	DataBlock.prototype.getTransactionID = function( aDataBlock ) {
		var oMeta = this._oAgentMetaInfo[ aDataBlock[this._oPropertyIndex.meta] + "" ];
		return oMeta[1] + "^" + oMeta[2] + "^" + aDataBlock[this._oPropertyIndex.transactionId];
	};
	DataBlock.prototype.getAgentName = function( aDataBlock ) {
		var oMeta = this._oAgentMetaInfo[ aDataBlock[this._oPropertyIndex.meta] + "" ];
		return oMeta[0];
	};
	DataBlock.prototype.getX = function() {
		return {
			"min": this._minX,
			"max": this._maxX
		};
	};
	DataBlock.prototype.isEmpty = function() {
		return this._aAllData.length === 0;
	};

	global.BigScatterChart2.DataBlock = DataBlock;
})(window, jQuery);
(function(global, $) {
	'use strict';
	var DRAG_TO_SELECT_COMPONENT_CLASS = "jquery-drag-to-select";
	function DragManager( option, oSizeCoordinateManager, $elContainer, oCallback ) {
		this._option = option;
		this._oCallback = oCallback;
		this._oSCManager = oSizeCoordinateManager;
		this._$elContainer = $elContainer;

		this._initVariable();
		this._initElement( $elContainer );
		this._initEvent();
	}
	DragManager.prototype.option = function( key ) {
		return this._option[key];
	};
	DragManager.prototype._initVariable = function() {
	};
	DragManager.prototype._initElement = function( $elContainer ) {
		var oPadding = this._oSCManager.getPadding();
		var lineColor = this.option( "lineColor" );
		var axisLabelStyle = this.option( "axisLabelStyle" );

		this._$element = $("<div>").css({
			"top": "0px",
			"left": "0px",
			"width": this._oSCManager.getWidth() + "px",
			"height": this._oSCManager.getHeight() + "px",
			"cursor": "crosshair",
			"z-index": 500,
			"position": "absolute",
			"background-color": "rgba(0,0,0,0)" // for ie10
		}).addClass("overlay").appendTo( $elContainer );

		this._welXGuideNumber = $("<div>")
			.css({
				"top": ( this._oSCManager.getHeight() - oPadding.bottom + 10) + "px",
				"left": "0px",
				"color": lineColor,
				"width": "56px",
				"height": "22px",
				"border": "1px solid #ccc",
				"display": "none",
				"position": "absolute",
				"text-align": "center",
				"background": "#fff",
				"line-height": "22px",
				"margin-left": "-28px",
				"border-radius": "5px"
			})
			.css(axisLabelStyle)
			.append( $("<span></span>") )
			.append( $("<div>").css({
				"top": "-10px",
				"left": "27px",
				"height": "10px",
				"position": "absolute",
				"border-left": "1px solid red"
			}))
			.appendTo( this._$element );

		this._welYGuideNumber = $("<div>")
			.css({
				"top": "0px",
				"left": "0px",
				"color": lineColor,
				"width": (56 - 15) + "px",
				"height": "22px",
				"border": "1px solid #ccc",
				"display": "none",
				"position": "absolute",
				"margin-top": "-10px",
				"text-align": "right",
				"background": "#fff",
				"line-height": "22px",
				"padding-right": "3px",
				"border-radius": "5px",
				"vertical-align": "middle"
			})
			.css(axisLabelStyle)
			.append($("<span></span>"))
			.append( $("<div>").css({
				"top": "9px",
				"right": "-10px",
				"width": "10px",
				"position": "absolute",
				"border-top": "1px solid red"
			}))
			.appendTo( this._$element );
	};
	DragManager.prototype._initEvent = function() {
		var self = this;
		var bGuideLineStart = false;

		this._$element.dragToSelect({
			className: DRAG_TO_SELECT_COMPONENT_CLASS,
			onHide: function ( $elDragArea ) {
				var oDragAreaPosition = self._adjustSelectBoxForChart( $elDragArea );
				self._oCallback.onSelect( oDragAreaPosition, self._parseCoordinatesToXY( oDragAreaPosition ) );
				self._$elDragArea = $elDragArea;
				self._$elDragArea.hide();
				self._hideGuideValue();
				bGuideLineStart = false;
			},
			onMove: function (e) {
				if (!self.option( "bUseMouseGuideLine" ) ) {
					return false;
				}
				if ( self._checkMouseXYInChart(e.pageX, e.pageY ) ) {
					if (!bGuideLineStart) {
						self._showGuideValue();
						bGuideLineStart = true;
					}
					self._moveGuideValue(e.pageX, e.pageY);
				} else {
					bGuideLineStart = false;
					self._hideGuideValue();
				}
			},
			onLeave: function(e) {
				bGuideLineStart = false;
				self._hideGuideValue();
			}
		});
	};
	DragManager.prototype._checkMouseXYInChart = function( x, y ) {
		var oPadding = this._oSCManager.getPadding();
		var bubbleSize = this._oSCManager.getBubbleSize();
		var oContainerOffset = this._$elContainer.offset();
		var minX = oContainerOffset.left + oPadding.left + bubbleSize;
		var maxX = oContainerOffset.left + this._$elContainer.width() - oPadding.right - bubbleSize;
		var minY = oContainerOffset.top + oPadding.top + bubbleSize;
		var maxY = oContainerOffset.top + this._$elContainer.height() - oPadding.bottom - bubbleSize;

		if ( x >= minX && x <= maxX && y >= minY && y <= maxY ) {
			return true;
		} else {
			return false;
		}
	};
	DragManager.prototype.triggerDrag = function( welFakeSelectBox ) {
		var oDragAreaPosition = this._adjustSelectBoxForChart( welFakeSelectBox );
		this._oCallback.onSelect( oDragAreaPosition, this._parseCoordinatesToXY( oDragAreaPosition ) );
	};
	DragManager.prototype._adjustSelectBoxForChart = function(welSelectBox) {
		var oPadding = this._oSCManager.getPadding();
		var bubbleSize = this._oSCManager.getBubbleSize();
		var nMinTop =  oPadding.top + bubbleSize;
		var nMinLeft = oPadding.left + bubbleSize;
		var nMaxRight = this._oSCManager.getWidth() - oPadding.right - bubbleSize ;
		var nMaxBottom = this._oSCManager.getHeight() - oPadding.bottom - bubbleSize;

		var nLeft = parseInt(welSelectBox.css("left"), 10);
		var nRight = nLeft + welSelectBox.width();
		var nTop = parseInt(welSelectBox.css("top"), 10);
		var nBottom = nTop + welSelectBox.height();

		nTop = Math.max( nTop, nMinTop );
		nLeft = Math.max( nLeft, nMinLeft );
		nRight = Math.min( nRight, nMaxRight );
		nBottom = Math.min( nBottom, nMaxBottom );

		var oNextInfo = {
			"top": nTop,
			"left": nLeft,
			"width": nRight - nLeft,
			"height": nBottom - nTop
		};
		welSelectBox.animate( oNextInfo, 200 );
		return oNextInfo;
	};
	DragManager.prototype._parseCoordinatesToXY = function( oPosition ) {
		var oPadding = this._oSCManager.getPadding();
		var bubbleSize = this._oSCManager.getBubbleSize();
		return {
			"fromX": this._oSCManager.parseMouseXToXData( oPosition.left - oPadding.left - bubbleSize ),
			"toX": this._oSCManager.parseMouseXToXData( oPosition.left + oPosition.width - oPadding.left - bubbleSize ),
			"fromY": this._oSCManager.parseMouseYToYData( this._oSCManager.getHeight() - ( oPadding.bottom + bubbleSize ) - ( oPosition.top + oPosition.height ) ),
			"toY": this._oSCManager.parseMouseYToYData( this._oSCManager.getHeight() - ( oPadding.bottom + bubbleSize ) - oPosition.top )
		};
	};
	DragManager.prototype._showGuideValue = function() {
		this._welXGuideNumber.show();
		this._welYGuideNumber.show();
	};
	DragManager.prototype._moveGuideValue = function( x, y ) {
		var oPadding = this._oSCManager.getPadding();
		var bubbleSize = this._oSCManager.getBubbleSize();
		var oContainerOffset = this._$elContainer.offset();
		var coordinateX = x - oContainerOffset.left;
		var coordinateY = y - oContainerOffset.top;

		this._welXGuideNumber.css("left", coordinateX ).find("span").text( moment( this._oSCManager.parseMouseXToXData( coordinateX - oPadding.left, bubbleSize ) ).format("HH:mm:ss"));
		this._welYGuideNumber.css( "top", coordinateY ).find("span").text( BigScatterChart2.Util.addComma( this._oSCManager.parseMouseYToYData( this._oSCManager.getHeight() - coordinateY - oPadding.bottom - bubbleSize )));
	};
	DragManager.prototype._hideGuideValue = function() {
		this._welXGuideNumber.hide();
		this._welYGuideNumber.hide();
	};
	//DragManager.prototype.moveDragArea = function( nXGap ) {
	//	if ( !this._$elDragArea || this._$elDragArea.width() < 2 ) return;
	//
	//	var nPositionXGap = ( nXGap / ( this._oSCManager.getGapX() ) ) * this._oSCManager.getWidthOfChartSpace();
	//
	//	var dragAreaOffsetLeft = parseInt( this._$elDragArea.css( "left" ), 10 );
	//	var drawAreaWidth = this._$elDragArea.width();
	//	var bubbleSize = this._oSCManager.getBubbleSize();
	//	var minX = this._oSCManager.getPadding().left + bubbleSize;
	//	var newOffsetLeft = dragAreaOffsetLeft - nPositionXGap;
	//
	//	if ( dragAreaOffsetLeft > minX ) {
	//		if ( newOffsetLeft > minX ) {
	//			this._$elDragArea.css( "left", newOffsetLeft );
	//		} else {
	//			this._$elDragArea.css( "left", minX );
	//			this._$elDragArea.width( drawAreaWidth + newOffsetLeft );
	//		}
	//	} else {
	//		this._$elDragArea.width( drawAreaWidth - nPositionXGap );
	//	}
	//
	//	if ( dragAreaOffsetLeft - nPositionXGap > minX ) {
	//		this._$elDragArea.css( "left", dragAreaOffsetLeft - nPositionXGap );
	//	}
	//};
	DragManager.prototype.hide = function() {
		this._hideGuideValue();
		this._$elContainer.find( "." + DRAG_TO_SELECT_COMPONENT_CLASS ).hide();
	};

	global.BigScatterChart2.DragManager = DragManager;
})(window, jQuery);
(function(global, $) {
	'use strict';
	function DataLoadManager( application, filter, option, cbLoaded ) {
		this._filter = filter;
		this._option = option;
		this._application = application;
		this._cbLoaded = cbLoaded;
		this._initVar();
	}
	DataLoadManager.prototype._initVar = function() {
		this._callCount = 0;
		this._bLoadCompleted = false;
		this._lastLoadTime = -1;
	};
	DataLoadManager.prototype.option = function( k ) {
		return this._option[k];
	};
	DataLoadManager.prototype.loadData = function( cbComplete, cbSuccess, cbFail, widthOfPixel, heightOfPixel ) {
		var self = this;
		var oFromTo = this._oSCManager.getX();

		this._oAjax = $.ajax({
			"url": this.getUrl(),
			"data": {
				"to": this._callCount === 0 ? oFromTo.max : this._lastLoadTime - 1,
				"from": oFromTo.min,
				"limit": this.option( "fetchLimit" ),
				"filter": this._filter || "",
				"application": this._application,
				"xGroupUnit": widthOfPixel,
				"yGroupUnit": heightOfPixel
			},
			"headers": { "accept": "application/json" },
			"dataType": "json"
		}).done(function( oResultData ) {
			if ( oResultData.exception ) {
				cbFail();
			} else {
				self._callCount += 1;
				self._bLoadCompleted = oResultData.complete;
				self._lastLoadTime = oResultData.resultFrom;
				cbSuccess(oResultData, !this._bLoadCompleted, self._getIntervalTime() );
			}
		}).always(function() {
			cbComplete();
		});
	};
	DataLoadManager.prototype.loadRealtimeData = function( callbackRealtimeSuccess, callbackRealtimeFail, widthOfPixel, heightOfPixel ) {
		var self = this;
		var oFromTo = this._oSCManager.getX();

		var beforeRequest = Date.now();
		var currentFrom = this._nextFrom || oFromTo.max;
		var currentTo = this._nextTo ||  oFromTo.max + this.option( "realtimeInterval" );

		this._oRealtimeAjax = $.ajax({
			"url": this.getUrl(),
			"data": {
				"to": currentTo,
				"from": currentFrom,
				"limit": this.option( "fetchLimit" ),
				"filter": "",
				"application": this._application,
				"xGroupUnit": widthOfPixel,
				"yGroupUnit": heightOfPixel,
				"backwardDirection": false
			},
			"headers": { "accept": "application/json" },
			"dataType": "json"
		}).done(function( oResultData ) {
			if ( oResultData.exception ) {
				callbackRealtimeFail();
			} else {

				self._nextFrom = oResultData.complete ? oResultData.to : oResultData.resultTo;
				self._nextTo = self._nextFrom + self.option( "realtimeInterval" );

				callbackRealtimeSuccess( oResultData, self._calcuRealtimeIntervalTime( oResultData.currentServerTime, Date.now() - beforeRequest ), self._isResetRealtime( oResultData.currentServerTime ), oResultData.currentServerTime );
				self._cbLoaded( self._oSCManager.getX(), self._nextFrom, self._nextTo );
			}
		}).fail(function() {
			self.loadRealtimeData( callbackRealtimeSuccess, callbackRealtimeFail, widthOfPixel, heightOfPixel );
		});
	};
	DataLoadManager.prototype._isResetRealtime = function( currentServerTime ) {
		return ( currentServerTime - this._nextTo ) >= this.option( "realtimeResetTimeGap" );
	};
	DataLoadManager.prototype._calcuRealtimeIntervalTime = function( currentServerTime, requestGap ) {
		var interval = parseInt( this.option( "realtimeInterval" ), 0 );
		if ( requestGap > interval ) {
			return 0;
		} else {
			var gapTime = ( currentServerTime - this._nextTo ) - this.option( "realtimeDefaultTimeGap" );
			if ( gapTime < 0 ) {
				return Math.max( interval - requestGap - gapTime, interval );
			} else {
				return Math.max( interval - requestGap - gapTime, 0 );
			}
		}
	};
	DataLoadManager.prototype.setRealtimeFrom = function( from ) {
		this._nextFrom = from;
		this._nextTo = from + this.option( "realtimeInteraval" );
	};
	DataLoadManager.prototype._getIntervalTime = function() {
		if (this.option( "useIntervalForFetching" ) ) {
			return this.option( "fetchingInterval" );
		}
		return 0;
	};
	DataLoadManager.prototype.getRealtimeInterval = function() {
		return this.option( "realtimeDefaultTimeGap" );
	}
	DataLoadManager.prototype.getUrl = function() {
		return this.option( "url" );
	};

	DataLoadManager.prototype.initCallCount = function() {
		this._callCount = 0;
	};
	DataLoadManager.prototype.isFirstRequest = function() {
		return this._callCount === 0;
	};
	DataLoadManager.prototype.isCompleted = function() {
		return this._bLoadCompleted;
	};
	DataLoadManager.prototype.abort = function() {
		if ( this._oAjax ) {
			this._oAjax.abort();
		}
		if ( this._oRealtimeAjax ) {
			this._oRealtimeAjax.abort();
		}
	};
	DataLoadManager.prototype.setTimeManager = function( oSCManager ) {
		this._oSCManager = oSCManager;
	};
	DataLoadManager.prototype.reset = function() {
		this._bLoadCompleted = false;
		this.initCallCount();
	};


	global.BigScatterChart2.DataLoadManager = DataLoadManager;
})(window, jQuery);
(function(global, $) {
	'use strict';
	function RendererManager( option, oSizeCoordinateManager, aAgentList, $elContainer ) {
		this._option = option;
		this._oSCManager = oSizeCoordinateManager;
		this._aAgentList = aAgentList;
		this._$elWrapper = $elContainer;

		this._initVariable();
		this._makeGridCanvas();
		this._makeAxisCanvas();
		this._drawGridLine();
		this._drawAxisLine();
		this._drawAxisValue();
		this.updateXYAxis();
		this._makeDataCanvas();
	}
	RendererManager.prototype.option = function( v ) {
		return this._option[v];
	};
	RendererManager.prototype._initVariable = function() {
		this._oElScrollCanvas = {};
		this._oScrollCtx = {};

		this._ticksOfX = this.option("ticksOfX") - 1;
		this._ticksOfY = this.option("ticksOfY") - 1;

		this._aElAxisX = [];
		this._aElAxisY = [];

		var oCheckboxImageData = this.option("checkBoxImage");
		this._oCheckedBoxImage = new Image();
		this._oCheckedBoxImage.src = oCheckboxImageData.checked;
		this._oUncheckedBoxImage = new Image();
		this._oUncheckedBoxImage.src = oCheckboxImageData.unchecked;
	};
	RendererManager.prototype._makeGridCanvas = function() {
		this._$elGuideCanvas = $("<canvas>").attr({
			"width": this._oSCManager.getWidth(),
			"height": this._oSCManager.getHeight()
		}).css({
			"top": 0,
			"z-index": 0,
			"position": "absolute"
		}).append( this._getNotSupportMarkup()).appendTo( this._$elWrapper );

		this._oCtxGrid = this._$elGuideCanvas.get(0).getContext("2d");
	};
	RendererManager.prototype._makeAxisCanvas = function() {
		this._$elAxisCanvas = $("<canvas>").attr({
			"width": this._oSCManager.getWidth(),
			"height": this._oSCManager.getHeight()
		}).css({
			"top": 0,
			"z-index": 10,
			"position": "absolute"
		}).append( this._getNotSupportMarkup() ).appendTo( this._$elWrapper);

		this._oCtxAxis = this._$elAxisCanvas.get(0).getContext("2d");
	};
	RendererManager.prototype._getNotSupportMarkup = function() {
		return $("<div>Your browser does not support the canvas element, get a better one!</div>").css({
			"color": "#fff",
			"width": this._oSCManager.getWidth(),
			"height": this._oSCManager.getHeight(),
			"text-align": "center",
			"background-color": "#8b2e19"
		});
	};
	RendererManager.prototype._drawGridLine = function() {

		var width = this._oSCManager.getWidth();
		var height = this._oSCManager.getHeight();
		var oPadding = this._oSCManager.getPadding();
		var bubbleSize = this._oSCManager.getBubbleSize();
		var tickX = this._oSCManager.getWidthOfChartSpace() / this._ticksOfX;
		var tickY = this._oSCManager.getHeightOfChartSpace() / this._ticksOfY;
		var i = 0, mov = 0;

		this._setStyle( this._oCtxGrid, this.option("gridAxisStyle") );

		for (i = 0; i <= this._ticksOfX; i++) {
			mov = oPadding.left + bubbleSize + tickX * i;
			this._oCtxGrid.beginPath();
			this._moveTo(this._oCtxGrid, mov, oPadding.top);
			this._lineTo(this._oCtxGrid, mov, height - oPadding.bottom);
			this._oCtxGrid.stroke();
		}
		for (i = 0; i <= this._ticksOfY; i++) {
			mov = height - (oPadding.bottom + bubbleSize + tickY * i);
			this._oCtxGrid.beginPath();
			this._moveTo(this._oCtxGrid, oPadding.left, mov);
			this._lineTo(this._oCtxGrid, width - oPadding.right, mov);
			this._oCtxGrid.stroke();
		}
	};

	RendererManager.prototype._drawAxisLine = function() {
		var width = this._oSCManager.getWidth();
		var height = this._oSCManager.getHeight();
		var oPadding = this._oSCManager.getPadding();
		var bubbleSize = this._oSCManager.getBubbleSize();
		var lineColor = this.option( "lineColor" );
		var gridAxisStyle = this.option( "gridAxisStyle" );
		var tickX = this._oSCManager.getWidthOfChartSpace() / this._ticksOfX;
		var tickY = this._oSCManager.getHeightOfChartSpace() / this._ticksOfY;
		var i = 0, mov = 0;

		this._oCtxAxis.lineWidth = gridAxisStyle.lineWidth;
		this._oCtxAxis.globalAlpha = 1;
		this._oCtxAxis.lineCap = "round";
		this._oCtxAxis.strokeStyle = lineColor;

		this._oCtxAxis.beginPath();
		this._moveTo(this._oCtxAxis, oPadding.left, oPadding.top);
		this._lineTo(this._oCtxAxis, oPadding.left, height - oPadding.bottom);
		this._lineTo(this._oCtxAxis, width - oPadding.right, height - oPadding.bottom);
		this._oCtxAxis.stroke();

		for ( i = 0 ; i <= this._ticksOfX ; i++ ) {
			mov = oPadding.left + bubbleSize + tickX * i;
			this._oCtxAxis.beginPath();
			this._moveTo(this._oCtxAxis, mov, height - oPadding.bottom);
			this._lineTo(this._oCtxAxis, mov, height - oPadding.bottom + 10);
			this._oCtxAxis.stroke();
		}

		for ( i = 0 ; i <= this._ticksOfY ; i++ ) {
			mov = height - (oPadding.bottom + bubbleSize + tickY * i);
			this._oCtxAxis.beginPath();
			this._moveTo(this._oCtxAxis, oPadding.left, mov);
			this._lineTo(this._oCtxAxis, oPadding.left - 10, mov);
			this._oCtxAxis.stroke();
		}
	};
	RendererManager.prototype._setStyle = function( ctx, oStyle ) {
		$.each( oStyle, function( key, value ) {
			if ( key === "lineDash" ) {
				ctx.setLineDash( value );
			} else {
				ctx[key] = value;
			}
		});
	};
	RendererManager.prototype._moveTo = function( ctx, x, y ) {
		if (x  % 1 === 0) {
			x += 0.5;
		}
		if (y  % 1 === 0) {
			y += 0.5;
		}
		ctx.moveTo(x, y);
	};
	RendererManager.prototype._lineTo = function( ctx, x, y ) {
		if (x  % 1 === 0) {
			x += 0.5;
		}
		if (y  % 1 === 0) {
			y += 0.5;
		}
		ctx.lineTo(x, y);
	};
	RendererManager.prototype._drawAxisValue = function() {
		var tickX = this._oSCManager.getWidthOfChartSpace() / this._ticksOfX;
		var tickY = this._oSCManager.getHeightOfChartSpace() / this._ticksOfY;
		var width = this._oSCManager.getWidth();
		var height = this._oSCManager.getHeight();
		var oPadding = this._oSCManager.getPadding();
		var bubbleSize = this._oSCManager.getBubbleSize();

		var sPrefix = this.option( "sPrefix" );
		var lineColor = this.option( "lineColor" );
		var axisLabelStyle = this.option( "axisLabelStyle" );
		var i = 0;

		this._welCoordinate = $("<div>").css({
			"top": 0,
			"width": width,
			"height": height,
			"cursor": "crosshair",
			"z-index": 10,
			"position": "absolute",
			"background-color": "rgba(0,0,0,0)" // for ie10
		}).addClass("coordinate").appendTo( this._$elWrapper );

		for ( i = 0 ; i <= this._ticksOfX ; i++ ) {
			this._aElAxisX.push(
				$("<div>").css({
					"top": (height - oPadding.bottom + 10) + "px",
					"left": oPadding.left - (tickX / 2) + i * tickX + "px",
					"color": lineColor,
					"width": tickX + "px",
					"position": "absolute",
					"text-align": "center"
				}).css( axisLabelStyle ).text(" ")
			);
		}
		// y axis
		for ( i = 0; i <= this._ticksOfY; i++ ) {
			this._aElAxisY.push(
				$("<div>").css({
					"top": ( bubbleSize + (i * tickY) + oPadding.top - 10) + "px",
					"left": "0px",
					"width": (oPadding.left - 15) + "px",
					"color": lineColor,
					"position": "absolute",
					"text-align": "right",
					"vertical-align": "middle"
				}).css( axisLabelStyle ).text(" ")
			);
		}
		this._welCoordinate.append( this._aElAxisX ).append( this._aElAxisY );

		// labelX
		var labelX = this.option( "labelX" );
		if ( BigScatterChart2.Util.isString( labelX ) && labelX.length > 0 ) {
			$("<div>")
			.text(labelX )
			.css( axisLabelStyle )
			.css({
				"top": ( height - oPadding.bottom + 10) + "px",
				"right": 0,
				"color": lineColor,
				"position": "absolute",
				"text-align": "center"
			}).appendTo( this._welCoordinate );
		}

		// labeY
		var labelY = this.option( "labelY" );
		if ( BigScatterChart2.Util.isString( labelY ) && labelY.length > 0 ) {
			$("<div>")
			.text( labelY )
			.css( axisLabelStyle )
			.css({
				"top": ( bubbleSize + oPadding.top + 10) + "px",
				"left": "0px",
				"color": lineColor,
				"width": ( oPadding.left - 15) + "px",
				"position": "absolute",
				"text-align": "right",
				"vertical-align": "middle"
			}).appendTo( this._welCoordinate );
		}
	};
	RendererManager.prototype._makeDataCanvas = function() {
		var self = this;
		var bubbleSize = this._oSCManager.getBubbleSize();
		var sPrefix = this.option("sPrefix");
		var zIndex = 100;
		var aBubbleTypeInfo = this.option("typeInfo");

		var widthOfChartSpace = this._oSCManager.getWidthOfChartSpace();
		var heightOfChartSpace = this._oSCManager.getHeightOfChartSpace();
		var canvasWidth = this._oSCManager.getCanvasWidth();
		this._$elScroller = $("<div>").css({
			"top": "0px",
			"left": "0px",
			"height": ( heightOfChartSpace + bubbleSize * 2 ) + "px",
			"position": "absolute",
			"background-color": "gray"
		}).addClass( "canvas-scroller" );

		$("<div>").css({
			"top": this._oSCManager.getTopOfChartSpace() + "px",
			"left": ( this._oSCManager.getLeftOfChartSpace() + bubbleSize ) + "px",
			"width": widthOfChartSpace + "px",
			"height": ( heightOfChartSpace + bubbleSize * 2 ) + "px",
			"z-index": zIndex++,
			"overflow": "hidden",
			"position": "absolute"
		}).addClass( "canvas-wrapper" ).append( this._$elScroller ).appendTo( this._$elWrapper );

		$.each( this._aAgentList, function( index, agentName ) {
			$.each( aBubbleTypeInfo, function( index, aValue ) {
				var key = BigScatterChart2.Util.makeKey( agentName, sPrefix, aValue[0] );
				self._oElScrollCanvas[key] = [
					$("<canvas>").attr({
						"width": canvasWidth,
						"height": ( heightOfChartSpace + bubbleSize * 2 ) + "px",
						"data-key": key
					}).css({
						"top": "0px",
						"left": "0px",
						"z-index": zIndex++,
						"position": "absolute"
					}).appendTo( self._$elScroller ),
					$("<canvas>").attr({
						"width": canvasWidth,
						"height": ( heightOfChartSpace + bubbleSize * 2 ) + "px",
						"data-key": key
					}).css({
						"top": "0px",
						"left": canvasWidth + "px",
						//"background-color": "rgba( 240, 240, 240, 0.3 )",
						"z-index": zIndex++,
						"position": "absolute"
					}).appendTo( self._$elScroller )
				];

				self._oScrollCtx[key] = [
					self._oElScrollCanvas[key][0].get(0).getContext("2d"),
					self._oElScrollCanvas[key][1].get(0).getContext("2d")
				];
			});
		});
		this._oScrollIndexOrder = [ 0, 1 ];

	};
	RendererManager.prototype.getChartAsImage = function( type, oElType ) {
		return this._mergeAllDisplay( oElType ).get(0).toDataURL("image/" + type.toLowerCase() );
	};
	RendererManager.prototype.updateXYAxis = function( minX, maxX, minY, maxY ) {
		var self = this;
		if ($.isNumeric(minX)) {
			//this._minX = this.option("minX", minX);
		}
		if ($.isNumeric(maxX)) {
			//this._maxX = this.option("minX", maxX);
		}
		if ($.isNumeric(minY)) {
			//this._minY = this.option("minY", minY);
		}
		if ($.isNumeric(maxY)) {
			//this._maxY = this.option("maxY", maxY);
		}

		var fnXAxisFormat = this.option( "fnXAxisFormat" );
		var oRangeX = this._oSCManager.getX();
		var tickX = ( this._oSCManager.getGapX() ) / this._ticksOfX;
		$.each( this._aElAxisX, function ( index, $el ) {
			if ( $.isFunction( fnXAxisFormat ) ) {
				$el.html( fnXAxisFormat.call( self, tickX, index, oRangeX.min ) );
			} else {
				$el.html( ( tickX * index + oRangeX.min ).round() );
			}
		});

		var fnYAxisFormat = this.option( "fnYAxisFormat" );
		var oRangeY = this._oSCManager.getY();
		var tickY = ( this._oSCManager.getGapY() ) / this._ticksOfY;
		$.each( this._aElAxisY, function ( index, $el ) {
			if ( $.isFunction( fnYAxisFormat ) ) {
				$el.html( fnYAxisFormat.call( self, tickY, index, oRangeY.min, oRangeY.max ) );
			} else {
				$el.html( BigScatterChart2.Util.addComma( ( oRangeY.max + oRangeY.min ) - ( ( tickY * index ) + oRangeY.min ) ) );
			}
		});
	};
	RendererManager.prototype.clear = function() {
		var width = this._oSCManager.getCanvasWidth();
		var height = this._oSCManager.getHeight();

		$.each( this._oScrollCtx, function( key, aCtx ) {
			$.each( aCtx, function( i, ctx ) {
				ctx.clearRect(0, 0, width, height);
			});
		});
	};
	RendererManager.prototype.selectType = function( agentName, type ) {
		$.each( this._oElScrollCanvas, function( key, aCanvas ) {
			$.each( aCanvas, function( i, $elCanvas ) {
				if (BigScatterChart2.Util.endsWith(key, type)) {
					$elCanvas.show();
				} else {
					$elCanvas.hide();
				}
			});
		});
	};
	RendererManager.prototype.toggle = function( type ) {
		$.each( this._oElScrollCanvas, function( key, aCanvas ) {
			$.each( aCanvas, function( i, $elCanvas ) {
				if (BigScatterChart2.Util.endsWith(key, type)) {
					$elCanvas.toggle();
				}
			});
		});
	};
	RendererManager.prototype.showSelectedAgent = function( bIsAll, agentName, oTypeCheckInfo ) {
		var self = this;
		$.each( this._oElScrollCanvas, function( key, aCanvas ) {
			if ( bIsAll ) {
				var visibleCmd = self._visible( key.split("-"), oTypeCheckInfo ) ? "show" : "hide";
				$.each( aCanvas, function( i, $elCanvas ) {
					$elCanvas[ visibleCmd ]();
				});
			} else {
				$.each( aCanvas, function( i, $elCanvas ) {
					if (BigScatterChart2.Util.startsWith(key, agentName)) {
						$elCanvas[self._visible(key.split("-"), oTypeCheckInfo) ? "show" : "hide"]();
					} else {
						$elCanvas.hide();
					}
				});
			}
		});
	};
	RendererManager.prototype._visible = function( aData, oTypeCheckInfo ) {
		return oTypeCheckInfo[aData[ aData.length - 1 ]];
	};
	RendererManager.prototype.drawBubble = function( key, color, aBubbleData ) {
		var oPropertyIndex = this.option( "propertyIndex" );
		var bubbleRadius = this.option( "bubbleRadius" );
		var oRangeY = this._oSCManager.getY();

		var x = ( aBubbleData[oPropertyIndex.x] - this._oSCManager.getStartX() ) * this._oSCManager.getPixelPerTime();
		var y = this._oSCManager.parseYDataToYChart( BigScatterChart2.Util.getBoundaryValue( oRangeY, aBubbleData[oPropertyIndex.y]), false );
		var r = this._oSCManager.parseZDataToZChart( aBubbleData.r || bubbleRadius );

		var canvasWidth = this._oSCManager.getCanvasWidth();
		var ctxIndex = this._oScrollIndexOrder[0];
		var zeroLeft = parseInt( this._oElScrollCanvas[key][ctxIndex].css( "left" ) );
		var currentMaxX = zeroLeft + canvasWidth;
		if ( x > currentMaxX ) {
			ctxIndex = this._oScrollIndexOrder[1];
			x -= currentMaxX;
		} else {
			x -= zeroLeft;
		}

		this._oScrollCtx[key][ctxIndex].beginPath();
		this._oScrollCtx[key][ctxIndex].fillStyle = color;
		this._oScrollCtx[key][ctxIndex].strokeStyle = color;
		this._oScrollCtx[key][ctxIndex].arc( x, y, r, 0, Math.PI * 2, true );
		this._oScrollCtx[key][ctxIndex].globalAlpha = 0.3 + ( 0.1 * aBubbleData[oPropertyIndex.groupCount] );
		this._oScrollCtx[key][ctxIndex].fill();
	};
	RendererManager.prototype.moveChart = function( moveXValue, aniTime ) {
		var self = this;
		var canvasWidth = this._oSCManager.getCanvasWidth();
		var height = this._oSCManager.getHeight();
		var nextLeft = parseInt( this._$elScroller.css( "left" ), 10 ) - moveXValue;
		this._$elScroller.animate({
			"left": nextLeft
		}, aniTime, function() {
			var temp = self._oScrollIndexOrder[0];
			var bOverBoundary = false;
			$.each( self._oElScrollCanvas, function( key, aCanvas ) {
				if ( Math.abs( nextLeft ) > ( parseInt( aCanvas[self._oScrollIndexOrder[0]].css( "left" ) ) + canvasWidth ) ) {
					bOverBoundary = true;
					aCanvas[self._oScrollIndexOrder[0]].css( "left", parseInt( aCanvas[self._oScrollIndexOrder[1]].css( "left" ) ) + canvasWidth );
					self._oScrollCtx[key][self._oScrollIndexOrder[0]].clearRect( 0, 0, canvasWidth, height );
				}
			});
			if ( bOverBoundary ) {
				self._oScrollIndexOrder[0] = self._oScrollIndexOrder[1];
				self._oScrollIndexOrder[1] = temp;
			}
		});
	};
	RendererManager.prototype.reset = function() {
		var canvasWidth = this._oSCManager.getCanvasWidth();
		this._$elScroller.css( "left", 0 );
		this._oScrollIndexOrder = [ 0, 1 ];
		$.each( this._oElScrollCanvas, function( key, aCanvas ) {
			$.each( aCanvas, function( index, $elCanvas ) {
				$elCanvas.css( "left", index * canvasWidth );
			});
		});
		this.clear();
	};
	RendererManager.prototype._mergeAllDisplay = function( oElType )  {
		var self = this;
		var oPadding = this._oSCManager.getPadding();
		var bubbleSize = this._oSCManager.getBubbleSize();
		var width = this._oSCManager.getWidth();
		var height = this._oSCManager.getHeight();

		var $elDownloadCanvas = $("<canvas>").attr({
			"width": width,
			"height": height
		});
		var oCtx = $elDownloadCanvas.get(0).getContext("2d");
		oCtx.fillStyle = "#FFFFFF";
		oCtx.fillRect(0, 0, width, height);

		// grid
		oCtx.drawImage(this._$elGuideCanvas.get(0), 0, 0);

		// scatter
		$.each( this._oElScrollCanvas, function( key, aCanvas ) {
			$.each( aCanvas, function( i, $elCanvas ) {
				if ( $elCanvas.is(":visible") ) {
					oCtx.drawImage( $elCanvas.get(0), oPadding.left + bubbleSize, oPadding.top );
				}
			});
		});

		// xy axis
		oCtx.drawImage(this._$elAxisCanvas.get(0), 0, 0);

		// common setting
		oCtx.textBaseline = "top";


		// count
		var oWrapperOffset = this._$elWrapper.offset();
		oCtx.textAlign = "left";
		$.each( oElType, function (sKey, $elLI) {
			var oOffset = $elLI.offset();
			var x = oOffset.left - oWrapperOffset.left;
			var y = oOffset.top - oWrapperOffset.top;

			oCtx.font = $elLI.css("font");
			oCtx.fillStyle = $elLI.css("color");
			oCtx.fillText( $elLI.text(), x + parseInt($elLI.css("padding-left"), 10), y );

			if ($elLI.hasClass("unchecked")) {
				oCtx.drawImage(self._oUncheckedBoxImage, x, y);
			} else {
				oCtx.drawImage(self._oCheckedBoxImage, x, y);
			}
		});

		// x axis
		oCtx.textAlign = "center";
		$.each(this._aElAxisX, function ( index, $elAxis) {
			oCtx.font = $elAxis.css("font");
			oCtx.fillStyle = $elAxis.css("color");
			oCtx.fillText( $elAxis.text(), parseInt( $elAxis.css( "left" ), 10 ) + $elAxis.get(0).getBoundingClientRect().width / 2, parseInt( $elAxis.css( "top" ), 10 ) );
		});

		// y axis
		oCtx.textAlign = "right";
		$.each(this._aElAxisY, function (index, $elAxis) {
			oCtx.font = $elAxis.css("font");
			oCtx.fillStyle = $elAxis.css("color");
			oCtx.fillText( $elAxis.text(), parseInt( $elAxis.css( "left" ), 10 ) + $elAxis.get(0).getBoundingClientRect().width, parseInt($elAxis.css("top"), 10) );
		});

		/*
		// x label
		if (this._welXLabel) {
			oCtx.textAlign = "right";
			oCtx.font = this._welXLabel.css("font");
			oCtx.fillStyle = this._welXLabel.css("color");
			oCtx.fillText(this._welXLabel.text(), width, parseInt(this._welXLabel.css("top"), 10));
		}

		// y label
		if (this._welYLabel) {
			oCtx.textAlign = "right";
			oCtx.font = this._welYLabel.css("font");
			oCtx.fillStyle = this._welYLabel.css("color");
			oCtx.fillText(this._welYLabel.text(), parseInt(this._welYLabel.css("left"), 10) + this._welYLabel.width(), parseInt(this._welYLabel.css("top"), 10));
		}
		*/

		// nodata
		//if ( $elNoData.css("display") === "block" ) {
		//	oCtx.textAlign = "center";
		//	oCtx.font = $elNoData.css("font");
		//	oCtx.fillStyle = $elNoData.css("color");
		//	oCtx.fillText( $elNoData.text(), parseInt( $elNoData.css("top") ), width / 2);
		//}

		//// drag-selecting
		//var sDragToSelectClassName = this.option("sDragToSelectClassName"),
		//	welDragToSelect = $("." + sDragToSelectClassName);
		//oCtx.rect(parseInt(welDragToSelect.css("left")), parseInt(welDragToSelect.css("top")), welDragToSelect.width(), welDragToSelect.height());
		//oCtx.globalAlpha = welDragToSelect.css("opacity");
		//oCtx.fillStyle = welDragToSelect.css("background-color");
		//oCtx.fill();
		//oCtx.strokeStyle = welDragToSelect.css("border-color");
		//oCtx.stroke();

		return $elDownloadCanvas;
	};

	global.BigScatterChart2.RendererManager = RendererManager;
})(window, jQuery);
(function(global, $) {
	'use strict';
	function BubbleTypeManager( option, oSizeCoordinateManager, $elContainer, oCallback ) {
		this._option = option;
		this._oSCManager = oSizeCoordinateManager;
		this._oCallback = oCallback;
		this._initVar();
		this._initElements( $elContainer );
		this._initEvents();
	}
	BubbleTypeManager.prototype.option = function( key ) {
		return this._option[key];
	};
	BubbleTypeManager.prototype._initVar = function() {
		this._oReferenceLI = {};
		this._oReferenceSpan = {};
	};
	BubbleTypeManager.prototype._initElements = function( $elContainer ) {
		var self = this;
		var oPadding = this._oSCManager.getPadding();

		this._$element = $("<div>").css({
			"top": 0,
			"width": this._oSCManager.getWidth() - oPadding.right,
			"height": oPadding.top,
			"cursor": "pointer",
			"z-index": 510,
			"position": "absolute",
			"background-color": "rgba(0,0,0,0)" // for ie10
		}).addClass("bubble-type");

		this._$elTypeUL = $("<ul>").css({
			"top": "5px",
			"margin": "0",
			"padding": "0",
			"position": "absolute",
			"font-size": "12px",
			"list-style": "none"
		});

		$.each( this._sortTypeInfo(), function ( index, aValue ) {
			// <li style="background-image:">TypeName : <span></span></li>
			self._$elTypeUL.append( self._oReferenceLI[aValue[0]] = $("<li>").attr("data-type", aValue[0]).css({
				"color": aValue[1],
				"margin": "0 0 0 20px",
				"padding": "0 0 0 19px",
				"display": "inline-block",
				"line-height": "15px",
				"background-image": "url(" + self.option("checkBoxImage").checked + ")",
				"background-repeat": "no-repeat"
			}).text(aValue[0] + " : ").append( self._oReferenceSpan[aValue[0]] = $("<span>").text("0") ) );
		});
		this._$element.append( this._$elTypeUL).appendTo( $elContainer );
	};
	BubbleTypeManager.prototype._sortTypeInfo = function() {
		var aOriginal = [];
		$.each( this.option("typeInfo"), function( key, a ) {
			aOriginal.push( a );
		});
		var mapped = aOriginal.map(function( a, i ) {
			return { index: i, value: a };
		});
		mapped.sort(function(a, b) {
			return a.value[2] - b.value[2];
		});

		return mapped.map(function( o ){
			return aOriginal[ o.index ];
		});
	};
	BubbleTypeManager.prototype._initEvents = function() {
		var self = this;
		var oCheckBoxImageData = this.option("checkBoxImage");

		this._$elTypeUL.on( "mousedown", function (e) {
			e.stopPropagation();
		}).on( "click", "li", function( e ) {
			e.preventDefault();
			var $elThis = $(this);
			var type = $elThis.attr("data-type");
			var bChecked = $elThis.hasClass("unchecked") === false;
			$elThis[ bChecked ? "addClass" : "removeClass"]("unchecked").css({
				"background-image": "url(" + oCheckBoxImageData[ bChecked ? "unchecked" : "checked" ] + ")"
			});
			self._oCallback.onChange( type );
			self._oCallback.onSend( type, !bChecked );
		});
	};
	BubbleTypeManager.prototype.showTypeCount = function( oTypeCount ) {
		var self = this;
		$.each( oTypeCount, function (sKey, sVal) {
			self._oReferenceSpan[sKey].text( BigScatterChart2.Util.addComma( sVal ) );
		});
	};
	BubbleTypeManager.prototype.getVisibleType = function() {
		var a = [];
		$.each(this._oReferenceLI, function( sKey, $elTypeLI ) {
			if ( $elTypeLI.hasClass("unchecked") === false ) {
				a.push(sKey);
			}
		});
		return a;
	};
	BubbleTypeManager.prototype.selectType = function( type ) {
		var oCheckBoxImageData = this.option("checkBoxImage");
		$.each( this._oReferenceLI, function( key, $elLI ) {
			if ( key === type ) {
				$elLI.removeClass("unchecked").css("background-image", "url(" + oCheckBoxImageData.checked + ")");
			} else {
				$elLI.addClass("unchecked").css("background-image", "url(" + oCheckBoxImageData.unchecked + ")");
			}
		});
	};
	BubbleTypeManager.prototype.selectAll = function() {
		var oCheckBoxImageData = this.option("checkBoxImage");
		$.each( this._oReferenceLI, function( key, $elLI ) {
			$elLI.removeClass("unchecked").css("background-image", "url(" + oCheckBoxImageData.checked + ")");
		})
	};
	BubbleTypeManager.prototype.isChecked = function( type ) {
		return this._oReferenceLI[type].hasClass("unchecked") === false;
	};
	BubbleTypeManager.prototype.getElementLI = function() {
		return this._oReferenceLI;
	};

	global.BigScatterChart2.BubbleTypeManager = BubbleTypeManager;
})(window, jQuery);
(function(global, $) {
	'use strict';
	function SizeCoordinateManager( option ) {
		this._option = option;
		this._initVar();
	}
	SizeCoordinateManager.prototype.option = function( key, value ) {
		if ( arguments.length === 1 ) {
			return this._option[key];
		} else {
			this._option[key] = value;
		}
	};
	SizeCoordinateManager.prototype._initVar = function() {
		var oPadding = this.option("padding");
		var	bubbleSize = this.option("bubbleSize");

		this._startX = this.option( "minX" );
		this._widthOfChartSpace = ( this.option("width") - ( oPadding.left + oPadding.right ) ) - bubbleSize * 2;
		this._heightOfChartSpace = ( this.option("height") - ( oPadding.top + oPadding.bottom ) ) - bubbleSize * 2;

		this._calcuUnitValue();
	};
	SizeCoordinateManager.prototype._calcuUnitValue = function() {
		this._timePerPixel = this.getGapX() / this._widthOfChartSpace;
		this._pixelPerTime = this._widthOfChartSpace / this.getGapX();
	};
	SizeCoordinateManager.prototype.getStartX = function() {
		return this._startX;
	};
	SizeCoordinateManager.prototype.getLeftOfChartSpace = function() {
		return this.option( "padding" ).left;
	};
	SizeCoordinateManager.prototype.getTopOfChartSpace = function() {
		return this.option( "padding" ).top;
	};
	SizeCoordinateManager.prototype.getCanvasWidth = function() {
		return this._widthOfChartSpace + 50;
	};
	SizeCoordinateManager.prototype.getWidth = function() {
		return this.option( "width" );
	};
	SizeCoordinateManager.prototype.getHeight = function() {
		return this.option( "height" );
	};
	SizeCoordinateManager.prototype.getX = function() {
		return {
			"min": this.option( "minX" ),
			"max": this.option( "maxX" )
		};
	};
	SizeCoordinateManager.prototype.setX = function( min, max, bReset ) {
		this.option( "minX", min );
		this.option( "maxX", max );
		if ( bReset === true ) {
			this._startX = min;
		}
		this._calcuUnitValue();
	};
	SizeCoordinateManager.prototype.getY = function() {
		return {
			"min": this.option( "minY" ),
			"max": this.option( "maxY" )
		};
	};
	SizeCoordinateManager.prototype.setY = function( min, max ) {
		this.option( "minY", min );
		this.option( "maxY", max );
	};
	SizeCoordinateManager.prototype.getPadding = function() {
		return this.option( "padding" );
	};
	SizeCoordinateManager.prototype.getBubbleSize = function() {
		return this.option( "bubbleSize" );
	};
	SizeCoordinateManager.prototype.getWidthOfChartSpace = function() {
		return this._widthOfChartSpace;
	};
	SizeCoordinateManager.prototype.getHeightOfChartSpace = function() {
		return this._heightOfChartSpace;
	};
	SizeCoordinateManager.prototype.getPixelPerTime = function() {
		return this._pixelPerTime;
	};
	SizeCoordinateManager.prototype.getTimePerPixel = function() {
		return this._timePerPixel;
	};
	//SizeCoordinateManager.prototype.parseXDataToXChart = function( x, plusPadding ) {
	//	return Math.round( ( ( x - this.option("minX") ) / this.getGapX() ) * this._widthOfChartSpace ) + this.option( "bubbleSize" ) + ( plusPadding ? this.option("padding").left : 0 );
	//};
	SizeCoordinateManager.prototype.parseYDataToYChart = function( y, plusPadding ) {
		return Math.round(this._heightOfChartSpace - (((y - this.option("minY") ) / this.getGapY() ) * this._heightOfChartSpace)) + this.option( "bubbleSize" ) + ( plusPadding ? this.option("padding").top : 0 );
	};
	SizeCoordinateManager.prototype.parseZDataToZChart = function( z ) {
		return Math.round( ( ( z - this.option( "minZ" ) ) / this.getGapZ() ) * this.option( "bubbleSize" ) );
	};
	SizeCoordinateManager.prototype.getLeftOfPluginArea = function() {
		return this.option("width") - this.option("padding").right;
	};
	SizeCoordinateManager.prototype.getXOfPixel = function() {
		return Math.round( ( this.option("maxX") - this.option("minX") ) / this._widthOfChartSpace );
	};
	SizeCoordinateManager.prototype.getYOfPixel = function() {
		return Math.round( ( this.option("maxY") - this.option("minY") ) / this._heightOfChartSpace );
	};
	SizeCoordinateManager.prototype.parseMouseXToXData = function( x ) {
		return Math.round((x / this._widthOfChartSpace ) * this.getGapX() ) + this.option( "minX" );
	};
	SizeCoordinateManager.prototype.parseMouseYToYData = function( y ) {
		return Math.round( ( y / this._heightOfChartSpace) * this.getGapY() );
	};
	SizeCoordinateManager.prototype.getGapX = function() {
		return this.option( "maxX" ) - this.option( "minX" );
	};
	SizeCoordinateManager.prototype.getGapY = function() {
		return this.option( "maxY" ) - this.option( "minY" );
	};
	SizeCoordinateManager.prototype.getGapZ = function() {
		return this.option( "maxZ" ) - this.option( "minZ" );
	};

	global.BigScatterChart2.SizeCoordinateManager = SizeCoordinateManager;
})(window, jQuery);
(function(global, $) {
	'use strict';

	global.BigScatterChart2.Util = {
		addComma: function( nNumber ) {
			var sNumber = nNumber + "";
			var sPattern = /(-?[0-9]+)([0-9]{3})/;
			while (sPattern.test(sNumber)) {
				sNumber = sNumber.replace(sPattern, "$1,$2");
			}
			return sNumber;
		},
		compare: function( aData, dataIndex, fnCompare ) {
			var targetIndex = 0;
			for( var i = 1, len = aData.length ; i < len ; i++ ) {
				var result = aData[targetIndex][dataIndex] - aData[i][dataIndex];
				if ( fnCompare( result ) ) {
					targetIndex = i;
				}
			}
			return aData[targetIndex][dataIndex];
		},
		min: function( result ) {
			return result > 0;
		},
		max: function( result ) {
			return result < 0;
		},
		indexOf: function( aData, value ) {
			for( var i = 0 ; i < aData.length ; i++ ) {
				if ( aData[i] === value ) {
					return i;
				}
			}
			return -1;
		},
		getBoundaryValue: function( oRange, value ) {
			return Math.min( oRange.max, Math.max( oRange.min, value ) );
		},
		isInRange: function( from, to, value ) {
			return value >= from && value <= to;
		},
		isEmpty: function( obj ) {
			var count = 0;
			for( var p in obj ) {
				count += obj[p].length;
			}
			return count === 0;
		},
		makeKey: function( a, b, c ) {
			return a + "-" + b + "-" + c;
		},
		isString: function( v ) {
			return typeof v === "string";
		},
		endsWith: function( str, value ) {
			var index = str.indexOf( value );
			if ( index !== -1 ) {
				if ( str.length - index === value.length ) {
					return true;
				}
			}
			return false;
		},
		startsWith: function( str, value ) {
			return str.indexOf( value ) === 0;
		}

	};
})(window, jQuery);
(function(global, $) {
	'use strict';
	function HelpPlugin( tooltipService ) {
		this._init( tooltipService );
	}
	HelpPlugin.prototype._init = function( tooltipService ) {
		this._tooltipService = tooltipService;
		this._aCallback = [];
	};
	HelpPlugin.prototype.initElement = function( $elParent, $elPlugin ) {
		var self = this;
		this._$element = $("<div>")
			.css({ "padding": "4px 0px 4px 20px" })
			.append(
				$("<span>").addClass("glyphicon glyphicon-question-sign scatterTooltip")
				.css("cursor", "pointer")
			)
			.appendTo( $elPlugin );

		setTimeout(function() {
			self._tooltipService.init("scatter");
		},0);
		return this;
	};
	HelpPlugin.prototype.initEvent = function( oChart ) {
		return this;
	};
	HelpPlugin.prototype.addCallback = function( fn ) {
		this._aCallback.push( fn );
	};

	global.BigScatterChart2.HelpPlugin = HelpPlugin;
})(window, jQuery);
(function(global, $) {
	'use strict';
	function MessagePlugin() {
		this._init();
	}
	MessagePlugin.prototype._init = function() {
		this._aCallback = [];
	};
	MessagePlugin.prototype.initElement = function( $elParent, $elPlugin, option ) {
		this._$element = $("<div>")
		.css({
			"top": 0,
			"width": option["width"],
			"height": option["height"],
			"cursor": "crosshair",
			"display": "none",
			"z-index": 1100,
			"position": "absolute",
			"background-color": "rgba(0,0,0,0)" // for ie10
		})
		.addClass("message-display")
		.append(
			$("<div>")
			.css( option["noDataStyle"] )
			.css({
				"top": ( option["height"] / 2  ) + "px",
				"width": option["width"] + "px",
				"position": "absolute",
				"text-align": "center"
			}
		)).appendTo( $elParent );

		return this;
	};
	MessagePlugin.prototype.initEvent = function( /* oChart */ ) {
		return this;
	};
	MessagePlugin.prototype.addCallback = function( fn ) {
		this._aCallback.push( fn );
	};
	MessagePlugin.prototype.show = function( message ) {
		this._$element.find("> div").html( message).end().show();
	};
	MessagePlugin.prototype.hide = function() {
		this._$element.hide();
	};

	global.BigScatterChart2.MessagePlugin = MessagePlugin;
})(window, jQuery);
(function(global, $) {
	'use strict';
	function SettingPlugin( sImage ) {
		this._init( sImage );
	}
	SettingPlugin.prototype._init = function( sImage ) {
		this._featureImage = sImage;
		this._aCallback = [];
	};
	SettingPlugin.prototype.initElement = function( $elParent, $elPlugin, option ) {
		var width = option["width"];
		var height = option["height"];

		var nCenterOfWidth = width / 2;
		var nMiddleOfHeight = height / 2;
		var nConfigLayerWidth = 200;
		var nConfigLayerHeight = 130;
		var randomMinID = "setting-min-" + parseInt( Math.random() * 100000 );
		var randomMaxID = "setting-max-" + parseInt( Math.random() * 100000 );

		this._$elConfigButton = $("<div>").css({
			"padding": "4px 0px 4px 20px"
		}).append( $("<img>").attr({
			"src": this._featureImage,
			"alt" : "Open Config",
			"title" : "Open Config"
		})).appendTo( $elPlugin );

		var template = [
			'<div class="config-layer">',
				'<div class="config-bg cancel"></div>',
				'<div class="dropdown-menu config">',
					'<h5>Setting</h5>',
					'<label for="" class="label">Min of Y axis</label>',
					'<input type="text" id="" class="input" value=""/>',
					'<label for="" class="label">Max of Y axis</label>',
					'<input type="text" id="" class="input" vlaue=""/>',
					'<button type="button" class="apply btn btn-default btn-xs">Apply</button>',
					'<button type="button" class="cancel btn btn-default btn-xs">Cancel</buton>',
				'</div>',
			'</div>'
		].join("");
		this._$element = $( template );
		this._$element.css({
			"width": width + "px",
			"height": height + "px",
			"display": "none",
			"position": "relative"
		});
		this._$element.find(".config-bg").css({
			"width": width + "px",
			"height": height + "px",
			"opacity": 0.3,
			"z-index": 1100,
			"position": "absolute",
			"background-color": "#000",
		});
		this._$element.find(".dropdown-menu").css({
			"top": nMiddleOfHeight - nConfigLayerHeight / 2 + "px",
			"left": nCenterOfWidth - nConfigLayerWidth / 2 + "px",
			"width": nConfigLayerWidth + "px",
			"height": nConfigLayerHeight + "px",
			"display": "block",
			"z-index": 1101
		});
		this._$element.find("label:first").attr("for", randomMinID);
		this._$element.find("label:last").attr("for", randomMaxID);
		this._$element.find("input[type=text]:first").attr("id", randomMinID).val( option["minY"] );
		this._$element.find("input[type=text]:last").attr("id", randomMaxID).val( option["maxY"] );
		$elParent.append( this._$element );

		return this;
	};
	SettingPlugin.prototype.hide = function() {
		this._$element.hide();
	};
	SettingPlugin.prototype.show = function() {
		this._$element.show();
	};
	SettingPlugin.prototype.initEvent = function( oChart ) {
		var self = this;

		this._$elConfigButton.click(function() {
			self.show();
		});
		this._$element.find(".cancel").click(function() {
			self.hide();
		});
		this._$element.find(".apply").click( function( event ) {
			event.preventDefault();
			var minY = parseInt( self._$element.find("input[type=text]:first").val(), 10 );
			var maxY = parseInt( self._$element.find("input[type=text]:last").val(), 10 );

			if (minY >= maxY) {
				alert("Min of Y axis is should be smaller than " + maxY);
				return;
			}
			$.each( self._aCallback, function( index, fn ) {
				fn( oChart, { "min": minY, "max": maxY } );
			});
			self.hide();
		});
		return this;
	};
	SettingPlugin.prototype.addCallback = function( fn ) {
		this._aCallback.push( fn );
		return this;
	};

	global.BigScatterChart2.SettingPlugin = SettingPlugin;
})(window, jQuery);
(function(global, $) {
	'use strict';
	function DownloadPlugin( imageData ) {
		this._init( imageData );
	}
	DownloadPlugin.prototype._init = function( imageData ) {
		this._featureImage = imageData;
		this._aCallback = [];
		this._bDisabled = false;
	};
	DownloadPlugin.prototype.initElement = function( $elParent, $elPlugin, option ) {
		this._bDisabled = option["realtime"];
		this._$element = $("<div>").css({
			"cursor": "pointer",
			"padding": "4px 0px 4px 20px"
		}).append(
			$("<a>").attr({
				"alt": "Download Scatter Chart",
				"href": "",
				"title": "Download Scatter Chart",
				"download": ""
			}).append(
				$("<img>").attr({
					"src": this._featureImage
				}).css({
					"opacity": this._bDisabled ? 0.2 : 1
				})
			)
		).appendTo( $elPlugin );
		return this;
	};
	DownloadPlugin.prototype.initEvent = function( oChart ) {
		var self = this;
		this._$element.find("a").on("click", function( event ) {
			event.preventDefault();
			if ( self._bDisabled ) return;
			$(this).attr({
				"href": oChart.getChartAsImage( "png" ),
				"download": "Pinpoint_Scatter_Chart[" + moment( oChart.option( "minX" ) ).format( "YYYYMMDD_HHmm" ) + "~" + moment( oChart.option( "maxX" ) ).format( "YYYYMMDD_HHmm" ) + "]"
			});
			$.each( self._aCallback, function( index, fn ) {
				fn( oChart );
			});
		});
		return this;
	};
	DownloadPlugin.prototype.addCallback = function( fn ) {
		this._aCallback.push( fn );
		return this;
	};

	global.BigScatterChart2.DownloadPlugin = DownloadPlugin;
})(window, jQuery);
(function(global, $) {
	'use strict';
	function WideOpenPlugin( sImage ) {
		this._init( sImage );
	}
	WideOpenPlugin.prototype._init = function( sImage ) {
		this._featureImage = sImage;
		this._aCallback = [];
		this._bDisabeld = false;
	};
	WideOpenPlugin.prototype.initElement = function( $elParent, $elPlugin ) {
		this._$element = $("<div>").css({
			"cursor": "pointer",
			"padding": "4px 0px 4px 20px"
		}).append( $("<img>").attr({
			"src": this._featureImage,
			"alt" : "Full Screen Mode",
			"title" : "Full Screen Mode"
		}) ).appendTo( $elPlugin );
		return this;
	};
	WideOpenPlugin.prototype.initEvent = function( oChart ) {
		var self = this;
		this._$element.on("click", function( event ) {
			event.preventDefault();
			$.each( self._aCallback, function( index, fn ) {
				fn( oChart, self._$element );
			});

		});
		return this;
	};
	WideOpenPlugin.prototype.addCallback = function( fn ) {
		this._aCallback.push( fn );
		return this;
	};

	global.BigScatterChart2.WideOpenPlugin = WideOpenPlugin;
})(window, jQuery);
/*! pinpoint - v1.5.2 - 2016-03-15 */(function(window, $) {
	'use strict';
	var ROW_SPARE_COUNT = 8;
	
	var ICS = function( options ){
		this.options = options;
		this._init();
		this._initOption();
		this._initVar();
		this._initEvent();			
		this._renderScrollArea();
	};
	ICS.prototype._init = function() {
		this.$wrapper = this.options.wrapper;
		this._threshold = this.options.elementHeight * (ROW_SPARE_COUNT / 4); // 2 * elementHeight		
	};
	ICS.prototype._initOption = function() {
		this._viewAreaHeight = this.options.viewAreaHeight;
		this._renderFunc = this.options.renderFunc || function() {};
		this._source = this.options.source;
		this._previousTop = 0;			
		this._previousTime = -1;
		this._selectedRow = -1;
	}
	ICS.prototype._initVar = function() {
		this._elementArray = [];
		this._elementArrayStartIndex = 0;
		this._elementArrayEndIndex = 0;
		this._elementArraySize = 0;
		this._previousTop = 0;			
	};
	ICS.prototype._initEvent = function() {
		var self = this;
		this.options.scroller.on("scroll", function(event) {
	    	self._scrollEventHandler(event, $(this));
	    });
	},
	ICS.prototype._isDefined = function( v ) {
		return typeof v != "undefined";
	};
	ICS.prototype._renderScrollArea = function() {
		if ( this._isDefined( this._source ) && this._isDefined( this.options.viewAreaHeight ) ) {
			this.reset();
		}
	},
	ICS.prototype._calculateElementStartCount = function() {
		var temp = parseInt( this._viewAreaHeight / this.options.elementHeight ) + ROW_SPARE_COUNT;
	    this._elementArraySize = temp > this._source.length ? this._source.length : temp;
	    this._elementArrayEndIndex = this._elementArraySize - 1; 
		this.$wrapper.height( this._source.length * this.options.elementHeight );
	};
	ICS.prototype._initElementArray = function() {
		this.$wrapper.empty();
		for( var i = 0 ; i < this._elementArraySize ; i++ ) {
	    	var $element = $(this.options.template);
	    	this._renderElement($element, i);
	    	this._elementArray.push($element);
	    	this.$wrapper.append($element);
	    }
	};
	ICS.prototype._renderElement = function($element, index)  {
		this._renderFunc.call( this, $element, index, this._source[index] );
		$element.attr("data-index", index).css("top", (index * this.options.elementHeight) + "px" );
	};
	ICS.prototype._getDataIndex = function(index) {
		return parseInt(this._elementArray[index].attr("data-index"));
	};
	ICS.prototype._getTopByIndex = function(index) {
		return parseInt(this._elementArray[index].css("top"));
	};
	ICS.prototype._getNextArrayIndex = function(index) {
		return index + 1 >= this._elementArraySize ? 0 : index + 1;
	};
	ICS.prototype._getPreviousArrayIndex = function(index) {
		return ( index - 1 < 0 ? this._elementArraySize : index ) - 1;
	};
	ICS.prototype._scrollEventHandler = function(event, $targetElement) {
		var top = $targetElement.scrollTop();
		var mTime = new Date().valueOf();
		if ( top == this._previousTop ) return;
		
		var bIsDown = top - this._previousTop > 0;
		if ( bIsDown ) { 	// scroll down 
			this._scrollDown(top, this._getTopByIndex(this._elementArrayStartIndex));
		} else {			// scroll up
			this._scrollUp(top, this._getTopByIndex(this._elementArrayEndIndex));
		}		
		this._previousTop = top;
		this._previousTime = mTime;
	};
	ICS.prototype._scrollDown = function( top, firstElementTop ) {
		var exceededDistance = top - firstElementTop - this._threshold;
		if ( exceededDistance >= 0 ) {
			var sourceLastIndex = this._getDataIndex(this._elementArrayEndIndex);
			var nextIndex = this._elementArrayStartIndex;
			var nextIndexStep = parseInt(exceededDistance / this.options.elementHeight);

			for( var i = 0 ; i < nextIndexStep ; i++ ) {
				var sourceIndex = sourceLastIndex + i + 1;
				if ( sourceIndex >= this._source.length ) {
					break;
				}
				if ( nextIndexStep - i <= this._elementArraySize * 2 ) {
					this._renderElement(this._elementArray[nextIndex], sourceIndex);						
				}
				nextIndex = this._getNextArrayIndex(nextIndex);
			}
			this._elementArrayStartIndex = nextIndex;
			this._elementArrayEndIndex = this._getPreviousArrayIndex(nextIndex);
		}
	},
	ICS.prototype._scrollUp = function( top, lastElementTop ) {
		var exceededDistance = lastElementTop + this.options.elementHeight - top - this._viewAreaHeight - this._threshold;
		if ( exceededDistance >= 0 ) {
			var sourceFirstIndex = this._getDataIndex(this._elementArrayStartIndex);
			var previousIndex = this._elementArrayEndIndex;
			var previousIndexStep = parseInt(exceededDistance / this.options.elementHeight);
			
			for( var i = 0 ; i < previousIndexStep ; i++ ) {
				var sourceIndex = sourceFirstIndex - (i + 1);
				if ( sourceIndex < 0 ) {
					break;
				}
				if ( previousIndexStep - i <= this._elementArraySize * 2 ) {	
					this._renderElement(this._elementArray[previousIndex], sourceIndex);
				}
				previousIndex = this._getPreviousArrayIndex(previousIndex);
			}
			this._elementArrayEndIndex = previousIndex;
			this._elementArrayStartIndex = this._getNextArrayIndex(previousIndex);
		}
	};
	ICS.prototype.source = function() {
		if ( arguments.length == 1 ) {
			this.options.source = arguments[0];
			return this;
		} else {
			return this._source;
		}
	};
	ICS.prototype.viewAreaHeight = function() {
		if ( arguments.length == 1 ) {
			this.options.viewAreaHeight = arguments[0];
			return this;			
		} else {
			return this._viewAreaHeight;
		}
	};
	ICS.prototype.renderFunc = function() {
		if ( arguments.length == 1 ) {
			this.options.renderFunc = arguments[0];
			return this;
		} else {
			return this._renderFunc;
		}
	};
	ICS.prototype.reset = function() {
		this._initOption();
		this._initVar();
		this._calculateElementStartCount();
		this._initElementArray();
		return this;
	};
	ICS.prototype.contentsAreaHeight = function() {
		return this.options.elementHeight * this._source.length;
	};
	ICS.prototype.destroy = function() {
		this.options.scroller.off("scroll");
	};
	ICS.prototype.resize = function( resizedViewAreaHeight ) {
		if ( this._isDefined( this._source ) === false ) return;
		var currentRow = parseInt(this.options.scroller.scrollTop() / this.options.elementHeight);
//		this.setViewAreaHeight(resizedViewAreaHeight);
		this.reset();
		this.moveByRow( currentRow );
	};
	ICS.prototype.moveByRow = function( row ) { // from 0
		var self = this;
		setTimeout(function() {
			self.options.scroller.scrollTop(row * self.options.elementHeight);
		},0);
	};
	ICS.prototype.searchRow = function( from, to, func) {
		var resultRow = -1;
		to = (to == -1 ? this._source.length : to);
		for( var i = from ; i < to ; i++ ) {
			if ( func(this._source[i]) ) {
				resultRow = i;
				break;
			}
		}
		return resultRow;
	};
	ICS.prototype.selectedRow = function(row, func) {
		if ( arguments.length == 0 ) {
			return this._selectedRow;
		} else {
			func.call(this, row);
			this._selectedRow = row;
			return this;
		}
	};
	window.InfiniteCircularScroll = ICS;
})(window, jQuery);